(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5282:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=5282,e.exports=t},1169:function(e,t,l){Promise.resolve().then(l.bind(l,7701))},7701:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return p}});var a=l(7437),r=l(2265),s=l(1994),n=l(8193);function i(e,t,l){var a,r,s;let n=new Map(e.map(e=>[e.id,e])),i=new Map;for(let t of e)i.set(t.id,{...t,children:[],partners:[]});for(let e of t)null===(a=i.get(e.partner_a))||void 0===a||a.partners.push(e.partner_b),null===(r=i.get(e.partner_b))||void 0===r||r.partners.push(e.partner_a);for(let e of l){null===(s=i.get(e.parent_id))||void 0===s||s.children.push(e.child_id);let t=i.get(e.child_id);t&&(t.parents||(t.parents=[]),t.parents.push(e.parent_id))}return{nodeById:i,personById:n}}var d=l(1388);let o=()=>(0,d.createBrowserClient)("https://knqbdesytcdyzuxclnoy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtucWJkZXN5dGNkeXp1eGNsbm95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMTkxNjEsImV4cCI6MjA2OTY5NTE2MX0.z9dGc6cn3MXAUagOY8bJm9-XKgqgiZS8bk81dz70uf8");var c=l(3538),u=l(9376);function h(e){var t,l,d;let{people:h,marriages:x,parentChild:p}=e,{nodeById:v}=(0,r.useMemo)(()=>i(h,x,p),[h,x,p]),[m,f]=(0,r.useState)(""),[g,b]=(0,r.useState)(new Set),[j,N]=(0,r.useState)(new Set),{editMode:_,setEditMode:w}=(0,c.S)(),y=(e,t)=>e<t?"".concat(e,"|").concat(t):"".concat(t,"|").concat(e),k=(0,r.useMemo)(()=>{var e,t,l,a,r,s,n,i,d,o;let c=new Set,u=e=>{let t=[e];for(;t.length;){var l,a,r,s;let e=t.pop();if(!c.has(e)){for(let a of(c.add(e),null!==(r=null===(l=v.get(e))||void 0===l?void 0:l.children)&&void 0!==r?r:[]))t.push(a);for(let l of null!==(s=null===(a=v.get(e))||void 0===a?void 0:a.partners)&&void 0!==s?s:[])t.push(l)}}};for(let n of g){let[i,d]=n.split("|");for(let n of new Set([...null!==(l=null===(e=v.get(i))||void 0===e?void 0:e.children)&&void 0!==l?l:[],...null!==(a=null===(t=v.get(d))||void 0===t?void 0:t.children)&&void 0!==a?a:[]]))for(let e of(u(n),null!==(s=null===(r=v.get(n))||void 0===r?void 0:r.partners)&&void 0!==s?s:[]))u(e)}for(let e of j)for(let t of null!==(i=null===(n=v.get(e))||void 0===n?void 0:n.children)&&void 0!==i?i:[])for(let e of(u(t),null!==(o=null===(d=v.get(t))||void 0===d?void 0:d.partners)&&void 0!==o?o:[]))u(e);return c},[g,j,v]),C=(0,r.useMemo)(()=>{let e=new Set(h.filter(e=>!k.has(e.id)).map(e=>e.id));return{ppl:h.filter(t=>e.has(t.id)),mar:x.filter(t=>e.has(t.partner_a)&&e.has(t.partner_b)),pc:p.filter(t=>e.has(t.parent_id)&&e.has(t.child_id))}},[h,x,p,k]),{nodeById:M}=(0,r.useMemo)(()=>i(C.ppl,C.mar,C.pc),[C]),{nodes:S,positionById:E}=(0,r.useMemo)(()=>(function(e,t,l){var a,r,s,n,i,d,o,c,u,h,x,p,v,m;let f=null!==(a=null==l?void 0:l.levelGap)&&void 0!==a?a:220;null==l||l.nodeGap;let g=null!==(r=null==l?void 0:l.cardWidth)&&void 0!==r?r:140,b=null!==(s=null==l?void 0:l.blockMargin)&&void 0!==s?s:30,j=new Map;for(let[e,l]of t)j.set(e,(null!==(n=l.generation)&&void 0!==n?n:0)|0);let N=new Map;for(let e of t.values())for(let t of e.partners)N.has(e.id)||N.set(e.id,[]),N.has(t)||N.set(t,[]),N.get(e.id).push(t),N.get(t).push(e.id);let _=new Set;for(let e of t.keys()){if(_.has(e))continue;let t=[e];_.add(e);let l=[];for(;t.length;){let e=t.pop();for(let a of(l.push(e),null!==(i=N.get(e))&&void 0!==i?i:[]))_.has(a)||(_.add(a),t.push(a))}let a=Math.min(...l.map(e=>{var t;return null!==(t=j.get(e))&&void 0!==t?t:0}));for(let e of l)j.set(e,a)}let w=new Map;for(let[e]of t){let t=null!==(d=j.get(e))&&void 0!==d?d:0;w.has(t)||w.set(t,[]),w.get(t).push(e)}let y=Array.from(w.keys()).sort((e,t)=>e-t),k=new Map,C=e=>{var l,a;let r=null!==(a=null===(l=t.get(e))||void 0===l?void 0:l.birth_date)&&void 0!==a?a:null;if(null===r)return Number.MAX_SAFE_INTEGER;let s=String(r).match(/\d{1,4}/),n=s?parseInt(s[0],10):Number.MAX_SAFE_INTEGER;return Number.isFinite(n)?n:Number.MAX_SAFE_INTEGER},M=e=>{var l,a;let r=new Set;for(let s of e)(null!==(a=null===(l=t.get(s))||void 0===l?void 0:l.parents)&&void 0!==a?a:[]).forEach(e=>r.add(e));let s=Array.from(r).map(e=>{var t;return null===(t=k.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);return 0===s.length?0:s.reduce((e,t)=>e+t,0)/s.length};for(let e of y){let a=e*f,r=w.get(e),s=new Set,n=[];for(let a of r){if(s.has(a))continue;s.add(a);let r=(null!==(c=null===(o=t.get(a))||void 0===o?void 0:o.partners)&&void 0!==c?c:[]).find(t=>{var l;return(null!==(l=j.get(t))&&void 0!==l?l:0)===e});if(r&&!s.has(r)){s.add(r);let e=t.get(a),i=t.get(r),d="M"===e.gender?e.id:"M"===i.gender?i.id:e.id,o=e.id===d?i.id:e.id,c=d<o?"".concat(d,"|").concat(o):"".concat(o,"|").concat(d),v=Math.min(C(d),C(o)),m=(null!==(x=null===(u=t.get(d))||void 0===u?void 0:u.parents)&&void 0!==x?x:[]).concat(null!==(p=null===(h=t.get(o))||void 0===h?void 0:h.parents)&&void 0!==p?p:[]).sort().join("|")||"single:".concat(d),f=M([d,o]);(null==l?void 0:l.collapsedCouples)&&l.collapsedCouples.has(c)?n.push({ids:[d],rank:v,parentsKey:m,weight:f}):n.push({ids:[d,o],rank:v,parentsKey:m,weight:f})}else{let e=C(a),l=(null!==(m=null===(v=t.get(a))||void 0===v?void 0:v.parents)&&void 0!==m?m:[]).sort().join("|")||"single:".concat(a),r=M([a]);n.push({ids:[a],rank:e,parentsKey:l,weight:r})}}let i=new Map;for(let e of n)i.has(e.parentsKey)||i.set(e.parentsKey,[]),i.get(e.parentsKey).push(e);let d=Array.from(i.entries()).sort((e,t)=>e[1].reduce((e,t)=>e+t.weight,0)/e[1].length-t[1].reduce((e,t)=>e+t.weight,0)/t[1].length),N=[],_=e=>{var l,a;let r=t.get(e);return"".concat(null!==(l=null==r?void 0:r.last_name)&&void 0!==l?l:""," ").concat(null!==(a=null==r?void 0:r.first_name)&&void 0!==a?a:"").toLowerCase()};for(let[,e]of d)e.sort((e,l)=>{if(e.rank!==l.rank)return e.rank-l.rank;let a=e=>{var l,a;let r=new Set;for(let s of e)(null!==(a=null===(l=t.get(s))||void 0===l?void 0:l.children)&&void 0!==a?a:[]).forEach(e=>r.add(e));return 0===r.size?Number.MAX_SAFE_INTEGER:Math.min(...Array.from(r).map(e=>C(e)))},r=a(e.ids),s=a(l.ids);if(r!==s)return r-s;let n=e.ids[0],i=l.ids[0];return _(n).localeCompare(_(i))}),N.push(...e);let y=0;for(let t of N){let l=2===t.ids.length?150+g:g,r=y+l/2;if(2===t.ids.length){let[l,s]=t.ids,n=r-75,i=r+75;k.set(l,{id:l,x:n,y:a,depth:e}),k.set(s,{id:s,x:i,y:a,depth:e})}else{let l=t.ids[0];k.set(l,{id:l,x:r,y:a,depth:e})}y+=l+b}let S=r.map(e=>{var t,l;return null!==(l=null===(t=k.get(e))||void 0===t?void 0:t.x)&&void 0!==l?l:0}),E=(Math.min(...S)+Math.max(...S))/2;for(let e of r){let t=k.get(e);t.x-=E}}return{nodes:Array.from(k.values()),positionById:k}})(0,M,{levelGap:220,nodeGap:220,cardWidth:140,blockMargin:40}),[[],M]),[A,L]=(0,r.useState)(.8),[I,D]=(0,r.useState)({x:300,y:160}),[F,z]=(0,r.useState)(!0),G=(0,r.useMemo)(()=>{let e=new Set(Array.from(v.values()).filter(e=>{var t;return(null!==(t=e.generation)&&void 0!==t?t:0)===1}).map(e=>e.id)),t=new Set;for(let l of x)e.has(l.partner_a)&&e.has(l.partner_b)&&t.add(y(l.partner_a,l.partner_b));let l=new Set;for(let e of v.values()){var a,r,s,n,i;if((null!==(s=e.generation)&&void 0!==s?s:0)!==1)continue;let t=(null!==(n=null===(a=e.partners)||void 0===a?void 0:a.length)&&void 0!==n?n:0)>0,d=(null!==(i=null===(r=e.children)||void 0===r?void 0:r.length)&&void 0!==i?i:0)>0;!t&&d&&l.add(e.id)}return{coupleKeys:t,singleIds:l}},[v,x]),X=(0,r.useRef)(!1);(0,r.useEffect)(()=>{if(X.current)return;let e=e=>(null!=e?e:"").toLowerCase().trim(),t=(t,l)=>{let a=e(t),r=e(l),s=Array.from(v.values()).find(t=>e(t.first_name||t.preferred_name)===a&&e(t.last_name)===r);return(null==s?void 0:s.id)||null},l=t("to dung","tran"),a=t("bao hue","chau"),{coupleKeys:r,singleIds:s}=G,n=l&&a?y(l,a):null,i=new Set;for(let e of r)n&&e===n||i.add(e);let d=new Set(s);b(i),N(d),X.current=!0},[v,x]);let B=()=>{let{coupleKeys:e,singleIds:t}=G;b(new Set(e)),N(new Set(t))},P=()=>{b(new Set),N(new Set)},R=(0,r.useMemo)(()=>{let{coupleKeys:e,singleIds:t}=G;for(let t of e)if(!g.has(t))return!1;for(let e of t)if(!j.has(e))return!1;return!0},[G,g,j]),T=e=>{var t,l;let a=null!==(l=null===(t=M.get(e))||void 0===t?void 0:t.parents)&&void 0!==l?l:[];if(a.length<2)return!1;let[r,s]=a,n=y(r,s);return g.has(n)},O=(0,r.useRef)(!1),W=(0,r.useRef)({x:0,y:0});(0,r.useMemo)(()=>{let e=m.trim().toLowerCase();return e?Array.from(M.values()).filter(t=>{var l,a,r;return"".concat(null!==(a=null!==(l=t.preferred_name)&&void 0!==l?l:t.first_name)&&void 0!==a?a:""," ").concat(null!==(r=t.last_name)&&void 0!==r?r:"").toLowerCase().includes(e)}):[]},[m,M]);let J=(e,t)=>{let l=E.get(e);if(!l)return;let a="number"==typeof t?Math.max(.3,Math.min(2,t)):A;L(a);let r={w:window.innerWidth,h:window.innerHeight};D({x:r.w/2-l.x*a,y:r.h/2-l.y*a})},U=e=>{var t,l;let a=null!==(l=null===(t=v.get(e))||void 0===t?void 0:t.partners)&&void 0!==l?l:[];if(0===a.length){N(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l});return}b(t=>{let l=new Set(t),r=a.every(t=>l.has(y(e,t)));for(let t of a){let a=y(e,t);r?l.delete(a):l.add(a)}return l})},Y=()=>{if(0===S.length)return;let e=S.map(e=>e.x),t=S.map(e=>e.y),l=Math.min(...e)-70,a=Math.max(...e)+70,r=Math.min(...t)-75,s=Math.max(...t)+75,n=window.innerWidth-(F?320:0),i=window.innerHeight-40,d=Math.min(2,Math.max(.3,.9*Math.min(n/(a-l),i/(s-r))));L(d),D({x:n/2+(F?320:0)/2-(l+a)/2*d,y:i/2-(r+s)/2*d})},[K,Z]=(0,r.useState)(null),H=K&&null!==(t=M.get(K))&&void 0!==t?t:null,q=(0,u.useRouter)(),Q=(0,r.useMemo)(()=>o(),[]),[V,$]=(0,r.useState)({});(0,r.useEffect)(()=>{var e,t,l,a,r,s,n,i,d,o,c,u,h;H&&$({first_name:null!==(e=H.first_name)&&void 0!==e?e:"",last_name:null!==(t=H.last_name)&&void 0!==t?t:"",preferred_name:null!==(l=H.preferred_name)&&void 0!==l?l:"",gender:null!==(a=H.gender)&&void 0!==a?a:null,birth_date:null!==(r=H.birth_date)&&void 0!==r?r:"",birth_place:null!==(s=H.birth_place)&&void 0!==s?s:"",death_date:null!==(n=H.death_date)&&void 0!==n?n:"",death_place:null!==(i=H.death_place)&&void 0!==i?i:"",status:null!==(d=H.status)&&void 0!==d?d:null,phone:null!==(o=H.phone)&&void 0!==o?o:"",facebook:null!==(c=H.facebook)&&void 0!==c?c:"",photo:null!==(u=H.photo)&&void 0!==u?u:"",generation:null!==(h=H.generation)&&void 0!==h?h:null})},[H]);let ee=async()=>{if(!H)return;let e={...V};try{await Q.from("people").update(e).eq("id",H.id),Z(null),q.refresh()}catch(e){console.error(e)}},[et,el]=(0,r.useState)(!1),[ea,er]=(0,r.useState)({gender:null,status:"Living"}),[es,en]=(0,r.useState)(""),[ei,ed]=(0,r.useState)(""),[eo,ec]=(0,r.useState)(""),eu=(0,r.useMemo)(()=>Array.from(M.values()),[M]),eh=async()=>{try{let{data:e,error:t}=await Q.from("people").insert({...ea}).select().single();if(t)throw t;let l=e.id;es&&await Q.from("parent_child").insert({parent_id:es,child_id:l}),ei&&await Q.from("parent_child").insert({parent_id:ei,child_id:l}),eo&&await Q.from("marriages").insert({partner_a:l,partner_b:eo}),el(!1),en(""),ed(""),ec(""),er({}),q.refresh()}catch(e){console.error(e)}};return(0,r.useEffect)(()=>{if(!H)return;let e=e=>{"Escape"===e.key&&Z(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[H]),(0,r.useEffect)(()=>{S.length>0&&Y()},[S.length]),(0,a.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[F&&(0,a.jsxs)("aside",{className:"w-80 border-r border-slate-800 bg-slate-900/70 glass p-4 space-y-4 overflow-y-auto relative",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 sticky top-0 bg-slate-900/90 py-2 z-10",children:[(0,a.jsx)(n.Z,{className:"h-5 w-5 text-slate-400"}),(0,a.jsx)("input",{className:"w-full rounded-md bg-slate-800/70 border border-slate-700 px-3 py-2 text-slate-100 placeholder:text-slate-400 focus:outline-none focus:ring",placeholder:"Search by name...",value:m,onChange:e=>f(e.target.value)})]}),(0,a.jsx)("div",{className:"sticky top-14 flex items-center gap-2 z-10 bg-slate-900/90 py-2",children:(0,a.jsxs)("label",{className:"inline-flex items-center gap-2 text-xs text-slate-300 whitespace-nowrap",children:[(0,a.jsx)("input",{type:"checkbox",checked:_,onChange:e=>w(e.target.checked)})," Edit mode"]})}),(0,a.jsxs)("div",{className:"sticky top-24 flex items-center gap-2 z-10 bg-slate-900/90 py-2",children:[(0,a.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>L(e=>Math.min(2,e+.1)),children:"+"}),(0,a.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>L(e=>Math.max(.3,e-.1)),children:"-"}),(0,a.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:Y,children:"Reset"}),(0,a.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>{R?P():B()},children:R?"Expand all":"Collapse all"}),(0,a.jsx)("button",{className:"ml-auto rounded bg-blue-600 hover:bg-blue-500 text-white px-3 py-1",onClick:()=>el(!0),children:"Add person"})]}),Array.from(new Set(h.map(e=>{var t;return null!==(t=e.generation)&&void 0!==t?t:0}))).sort((e,t)=>e-t).map(e=>{let t=h.filter(t=>{var l;return(null!==(l=t.generation)&&void 0!==l?l:0)===e}).sort((e,t)=>{var l,a,r,s,n,i,d,o,c,u;let h=(null!==(d=null===(l=M.get(e.id))||void 0===l?void 0:l.parents)&&void 0!==d?d:[]).slice().sort().join("|"),x=(null!==(o=null===(a=M.get(t.id))||void 0===a?void 0:a.parents)&&void 0!==o?o:[]).slice().sort().join("|"),p=(null!==(c=null===(s=M.get(e.id))||void 0===s?void 0:null===(r=s.parents)||void 0===r?void 0:r.length)&&void 0!==c?c:0)>0?0:1,v=(null!==(u=null===(i=M.get(t.id))||void 0===i?void 0:null===(n=i.parents)||void 0===n?void 0:n.length)&&void 0!==u?u:0)>0?0:1;return p!==v?p-v:h!==x?h.localeCompare(x):(null!=e.birth_date?parseInt(String(e.birth_date),10):Number.MAX_SAFE_INTEGER)-(null!=t.birth_date?parseInt(String(t.birth_date),10):Number.MAX_SAFE_INTEGER)}).map(e=>e.id);return(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Generation ",e]})}),t.map(e=>{var t;let l=M.get(e);if(!l)return null;let r=(l.preferred_name||l.first_name||"")+" "+(l.last_name||"");return m&&!r.toLowerCase().includes(m.toLowerCase())?null:(0,a.jsxs)("button",{className:"w-full flex items-center gap-3 rounded px-2 py-2 hover:bg-slate-800/70",onClick:()=>{J(e,1.2),_&&Z(e)},children:[l.photo?(0,a.jsx)("img",{src:l.photo,alt:r,className:"h-9 w-9 rounded-full object-cover"}):(0,a.jsx)("div",{className:"h-9 w-9 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-sm text-slate-100",children:r}),(0,a.jsx)("div",{className:"text-[11px] text-slate-400",children:null!==(t=l.status)&&void 0!==t?t:"Unknown"})]})]},e)})]},e)}),(0,a.jsx)("div",{className:"text-xs text-gray-500 mt-4",children:"Tip: drag to pan, scroll to zoom. Click a name to center."})]}),(0,a.jsxs)("main",{className:"flex-1 relative bg-gradient-to-b from-slate-900 to-slate-950",children:[(0,a.jsx)("button",{className:"absolute left-2 top-2 z-50 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40",onClick:()=>{z(e=>!e),setTimeout(Y,50)},children:F?"Hide sidebar":"Show sidebar"}),(0,a.jsxs)("svg",{className:"absolute inset-0 w-full h-full",onWheel:e=>{L(Math.min(2,Math.max(.3,A-.001*e.deltaY)))},onMouseDown:e=>{O.current=!0,W.current={x:e.clientX,y:e.clientY}},onMouseMove:e=>{if(!O.current)return;let t=e.clientX-W.current.x,l=e.clientY-W.current.y;D(e=>({x:e.x+t,y:e.y+l})),W.current={x:e.clientX,y:e.clientY}},onMouseUp:()=>{O.current=!1},children:[(0,a.jsx)("defs",{children:(0,a.jsx)("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:(0,a.jsx)("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#475569"})})}),(0,a.jsxs)("g",{transform:"translate(".concat(I.x,", ").concat(I.y,") scale(").concat(A,")"),children:[(()=>{let e=new Set;for(let t of C.mar){let l=t.partner_a<t.partner_b?t.partner_a:t.partner_b,a=t.partner_a<t.partner_b?t.partner_b:t.partner_a;e.add("".concat(l,"|").concat(a))}let t=new Map;for(let e of p)t.has(e.child_id)||t.set(e.child_id,new Set),t.get(e.child_id).add(e.parent_id);let l=[],r=new Set;for(let[a,s]of t){if(T(a)){r.add(a);continue}let t=Array.from(s);if(t.length>=2){let s=t[0],n=t[1],i=s<n?s:n,d=s<n?n:s;if(e.has("".concat(i,"|").concat(d))){let e=E.get(i),t=E.get(d),s=E.get(a);if(e&&t&&s){let n=(e.x+t.x)/2,o=Math.max(e.y,t.y)+75,c=s.x,u=s.y-75;l.push({key:"".concat(i,"-").concat(d,"-").concat(a),x1:n,y1:o,x2:c,y2:u}),r.add(a)}}}}for(let e of p){if(T(e.child_id)||r.has(e.child_id))continue;let t=E.get(e.parent_id),a=E.get(e.child_id);if(!t||!a)continue;let s=t.x,n=t.y+75,i=a.x,d=a.y-75;l.push({key:e.id,x1:s,y1:n,x2:i,y2:d})}return l.map(e=>(0,a.jsx)("path",{d:"M ".concat(e.x1," ").concat(e.y1," C ").concat(e.x1," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat(e.y2),stroke:"#475569",strokeWidth:"3",fill:"none",markerEnd:"url(#arrow)"},e.key))})(),C.mar.map(e=>{let t=E.get(e.partner_a),l=E.get(e.partner_b);if(!t||!l)return null;let r=t.y;return(0,a.jsx)("path",{d:"M ".concat(t.x+70," ").concat(r," L ").concat(l.x-70," ").concat(r),stroke:"#fb7185",strokeWidth:"3.5",fill:"none",strokeDasharray:"6 6"},e.id)}),(()=>{let e=Array.from(new Set(S.map(e=>e.depth))).sort((e,t)=>e-t),t=Math.min(...S.map(e=>e.x))-200,l=Math.max(...S.map(e=>e.x))+200;return e.map(e=>{let r=220*e;return(0,a.jsxs)("g",{children:[(0,a.jsx)("line",{x1:t,y1:r,x2:l,y2:r,stroke:"#1f2937",strokeDasharray:"6 10",strokeWidth:2}),(0,a.jsx)("rect",{x:t,y:r-20,width:120,height:28,rx:8,fill:"#0f172a",stroke:"#1f2937"}),(0,a.jsxs)("text",{x:t+60,y:r-2,fill:"#e2e8f0",fontSize:12,textAnchor:"middle",children:["Generation ",e]})]},e)})})(),Array.from(new Map(S.map(e=>[e.id,e])).values()).filter(e=>!T(e.id)).map(e=>{var t;let l=M.get(e.id),r="M"===l.gender?"bg-male/90":"F"===l.gender?"bg-female/90":"bg-neutral/80",n=(l.status||"").toLowerCase(),i=e.x-70,d=e.y-75;return(0,a.jsx)("foreignObject",{x:i,y:d,width:140,height:150,children:(0,a.jsxs)("div",{className:(0,s.W)("rounded-2xl shadow-card text-white flex flex-col items-center justify-center h-full px-3 py-2 cursor-pointer relative",r),onClick:()=>{_?Z(e.id):U(e.id)},children:[(0,a.jsx)("div",{className:"relative mb-2",children:l.photo?(0,a.jsx)("img",{src:l.photo,alt:null!==(t=l.first_name)&&void 0!==t?t:"",className:"h-12 w-12 rounded-full object-cover ring-2 ring-white/20"}):(0,a.jsx)("div",{className:"h-12 w-12 rounded-full bg-black/20 grid place-items-center text-2xl",children:"\uD83D\uDC64"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsxs)("div",{className:"text-xs font-semibold leading-4",children:[l.preferred_name||l.first_name," ",l.last_name]}),(0,a.jsx)("div",{className:(0,s.W)("text-[10px] opacity-90","deceased"===n?"text-deceased":"living"===n?"text-living":"text-slate-300"),children:l.status?String(l.status).toLowerCase():"unknown"}),(0,a.jsx)("div",{className:"flex items-center justify-center gap-2 mt-1 text-white/90",children:l.children.length>0&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 text-[10px]",children:[(0,a.jsx)("span",{role:"img","aria-label":"children",children:"\uD83D\uDC76"})," ",l.children.length]})})]})]})},e.id)})]})]}),H&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>Z(null),children:(0,a.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[800px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center gap-4 p-5 border-b border-slate-800",children:[H.photo?(0,a.jsx)("img",{src:H.photo,alt:"",className:"h-20 w-20 rounded-full object-cover ring-2 ring-white/10"}):(0,a.jsx)("div",{className:"h-20 w-20 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"text-xl font-semibold",children:[H.preferred_name||H.first_name," ",H.last_name]}),(0,a.jsx)("div",{className:"text-sm text-slate-400 capitalize",children:(H.status||"").toString()})]}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>Z(null),children:"Close"})]}),(0,a.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"First name"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.first_name||"",onChange:e=>$(t=>({...t,first_name:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Last name"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.last_name||"",onChange:e=>$(t=>({...t,last_name:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.preferred_name||"",onChange:e=>$(t=>({...t,preferred_name:e.target.value}))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Gender"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.gender||"",onChange:e=>$(t=>({...t,gender:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"—"}),(0,a.jsx)("option",{value:"M",children:"M"}),(0,a.jsx)("option",{value:"F",children:"F"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Status"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.status||"",onChange:e=>$(t=>({...t,status:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"—"}),(0,a.jsx)("option",{value:"Living",children:"Living"}),(0,a.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.birth_date||"",onChange:e=>$(t=>({...t,birth_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.birth_place||"",onChange:e=>$(t=>({...t,birth_place:e.target.value}))})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Death date"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.death_date||"",onChange:e=>$(t=>({...t,death_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Death place"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.death_place||"",onChange:e=>$(t=>({...t,death_place:e.target.value}))})]})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Phone"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.phone||"",onChange:e=>$(t=>({...t,phone:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Facebook"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.facebook||"",onChange:e=>$(t=>({...t,facebook:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:V.photo||"",onChange:e=>$(t=>({...t,photo:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Generation"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:String(null!==(l=V.generation)&&void 0!==l?l:""),onChange:e=>$(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null}))})]}),(0,a.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:ee,children:"Save"}),(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>Z(null),children:"Cancel"})]})]})]}),(0,a.jsxs)("div",{className:"p-5",children:[(0,a.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Family"}),(0,a.jsx)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:(0,a.jsx)("svg",{width:"100%",height:"240",viewBox:"0 0 640 240",children:(()=>{var e,t,l;let r=(null!==(e=H.parents)&&void 0!==e?e:[]).map(e=>M.get(e)).filter(Boolean),s=(null!==(t=H.partners)&&void 0!==t?t:[]).map(e=>M.get(e)).filter(Boolean),n=(null!==(l=H.children)&&void 0!==l?l:[]).map(e=>M.get(e)).filter(Boolean),i=r.map((e,t)=>160+t*(r.length>1?320:0)),d=s.map((e,t)=>320+(t+1)*140),o=n.length>1?n.map((e,t)=>100+440/(n.length-1)*t):[320],c=[];return r.forEach((e,t)=>{c.push((0,a.jsxs)("text",{x:i[t],y:30,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"pt-".concat(e.id))),c.push((0,a.jsx)("path",{d:"M ".concat(i[t]," ").concat(36," L ").concat(320," ").concat(106),stroke:"#64748b"},"p-line-".concat(e.id)))}),c.push((0,a.jsx)("circle",{cx:320,cy:120,r:12,fill:"#38bdf8"},"me")),c.push((0,a.jsxs)("text",{x:320,y:148,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[H.preferred_name||H.first_name," ",H.last_name||""]},"me-t")),s.forEach((e,t)=>{c.push((0,a.jsx)("circle",{cx:d[t],cy:120,r:10,fill:"#f472b6"},"sp-".concat(e.id))),c.push((0,a.jsx)("path",{d:"M ".concat(332," ").concat(120," L ").concat(d[t]-12," ").concat(120),stroke:"#fb7185",strokeDasharray:"6 4"},"m-".concat(e.id)))}),n.forEach((e,t)=>{c.push((0,a.jsxs)("text",{x:o[t],y:210,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"ch-".concat(e.id))),c.push((0,a.jsx)("path",{d:"M ".concat(320," ").concat(134," L ").concat(o[t]," ").concat(196),stroke:"#64748b"},"c-line-".concat(e.id)))}),c})()})})]})]})}),et&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>el(!1),children:(0,a.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[820px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-slate-800",children:[(0,a.jsx)("div",{className:"text-lg font-semibold",children:"Add new person"}),(0,a.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>el(!1),children:"Close"})]}),(0,a.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"First name"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.first_name||"",onChange:e=>er(t=>({...t,first_name:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Last name"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.last_name||"",onChange:e=>er(t=>({...t,last_name:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.preferred_name||"",onChange:e=>er(t=>({...t,preferred_name:e.target.value}))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Gender"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.gender||"",onChange:e=>er(t=>({...t,gender:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"—"}),(0,a.jsx)("option",{value:"M",children:"M"}),(0,a.jsx)("option",{value:"F",children:"F"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Status"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.status||"",onChange:e=>er(t=>({...t,status:e.target.value})),children:[(0,a.jsx)("option",{value:"",children:"—"}),(0,a.jsx)("option",{value:"Living",children:"Living"}),(0,a.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.birth_date||"",onChange:e=>er(t=>({...t,birth_date:e.target.value}))})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.birth_place||"",onChange:e=>er(t=>({...t,birth_place:e.target.value}))})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ea.photo||"",onChange:e=>er(t=>({...t,photo:e.target.value}))})]})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Generation"}),(0,a.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:String(null!==(d=ea.generation)&&void 0!==d?d:""),onChange:e=>er(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null}))})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:es,onChange:e=>en(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"—"}),eu.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ei,onChange:e=>ed(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"—"}),eu.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,a.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eo,onChange:e=>ec(e.target.value),children:[(0,a.jsx)("option",{value:"",children:"—"}),eu.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,a.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:eh,children:"Create"}),(0,a.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>el(!1),children:"Cancel"})]})]})]})]})})]})]})}var x=l(257);function p(){let[e,t]=(0,r.useState)(null),[l,s]=(0,r.useState)(null),[n,i]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{var e,l,a;if("true"===x.env.NEXT_PUBLIC_USE_JSON_FALLBACK||"true"===x.env.USE_JSON_FALLBACK)try{let e=await fetch("/data/sample.json",{cache:"no-store"});if(e.ok){let l=await e.json();t(l.people||[]),s(l.marriages||[]),i(l.parent_child||[]);return}}catch(e){}let r=o(),[n,d,c]=await Promise.all([r.from("people").select("*").returns(),r.from("marriages").select("*").returns(),r.from("parent_child").select("*").returns()]);t(null!==(e=n.data)&&void 0!==e?e:[]),s(null!==(l=d.data)&&void 0!==l?l:[]),i(null!==(a=c.data)&&void 0!==a?a:[])})()},[]),e&&l&&n)?(0,a.jsxs)("div",{className:"relative",children:[(0,a.jsx)(h,{people:e,marriages:l,parentChild:n}),(0,a.jsx)("div",{id:"modal-root",className:"fixed inset-0 pointer-events-none"})]}):(0,a.jsx)("div",{className:"min-h-screen grid place-items-center text-slate-300",children:"Loading…"})}},3538:function(e,t,l){"use strict";l.d(t,{EditModeProvider:function(){return n},S:function(){return i}});var a=l(7437),r=l(2265);let s=(0,r.createContext)(void 0);function n(e){let{children:t}=e,[l,n]=(0,r.useState)(!1);return(0,a.jsx)(s.Provider,{value:{editMode:l,setEditMode:n},children:t})}function i(){let e=(0,r.useContext)(s);if(!e)throw Error("useEditMode must be used within EditModeProvider");return e}}},function(e){e.O(0,[156,971,117,744],function(){return e(e.s=1169)}),_N_E=e.O()}]);