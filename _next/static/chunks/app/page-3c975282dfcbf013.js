(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5282:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=5282,e.exports=t},1169:function(e,t,l){Promise.resolve().then(l.bind(l,7701))},7701:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return p}});var r=l(7437),a=l(2265),n=l(1994),s=l(8193);function i(e,t,l){var r,a,n;let s=new Map(e.map(e=>[e.id,e])),i=new Map;for(let t of e)i.set(t.id,{...t,children:[],partners:[]});for(let e of t)null===(r=i.get(e.partner_a))||void 0===r||r.partners.push(e.partner_b),null===(a=i.get(e.partner_b))||void 0===a||a.partners.push(e.partner_a);for(let e of l){null===(n=i.get(e.parent_id))||void 0===n||n.children.push(e.child_id);let t=i.get(e.child_id);t&&(t.parents||(t.parents=[]),t.parents.push(e.parent_id))}return{nodeById:i,personById:s}}var d=l(1388);let o=()=>(0,d.createBrowserClient)("https://knqbdesytcdyzuxclnoy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtucWJkZXN5dGNkeXp1eGNsbm95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMTkxNjEsImV4cCI6MjA2OTY5NTE2MX0.z9dGc6cn3MXAUagOY8bJm9-XKgqgiZS8bk81dz70uf8");var c=l(3538),u=l(9376);function h(e){var t,l,d;let{people:h,marriages:x,parentChild:p,onChanged:v}=e,{nodeById:m}=(0,a.useMemo)(()=>i(h,x,p),[h,x,p]),[f,g]=(0,a.useState)(""),[b,j]=(0,a.useState)(new Set),[y,w]=(0,a.useState)(new Set),{editMode:_,setEditMode:N}=(0,c.S)(),k=(e,t)=>e<t?"".concat(e,"|").concat(t):"".concat(t,"|").concat(e),C=(0,a.useMemo)(()=>{var e,t,l,r,a,n,s,i,d,o;let c=new Set,u=e=>{let t=[e];for(;t.length;){var l,r,a,n;let e=t.pop();if(!c.has(e)){for(let r of(c.add(e),null!==(a=null===(l=m.get(e))||void 0===l?void 0:l.children)&&void 0!==a?a:[]))t.push(r);for(let l of null!==(n=null===(r=m.get(e))||void 0===r?void 0:r.partners)&&void 0!==n?n:[])t.push(l)}}};for(let s of b){let[i,d]=s.split("|");for(let s of new Set([...null!==(l=null===(e=m.get(i))||void 0===e?void 0:e.children)&&void 0!==l?l:[],...null!==(r=null===(t=m.get(d))||void 0===t?void 0:t.children)&&void 0!==r?r:[]]))for(let e of(u(s),null!==(n=null===(a=m.get(s))||void 0===a?void 0:a.partners)&&void 0!==n?n:[]))u(e)}for(let e of y)for(let t of null!==(i=null===(s=m.get(e))||void 0===s?void 0:s.children)&&void 0!==i?i:[])for(let e of(u(t),null!==(o=null===(d=m.get(t))||void 0===d?void 0:d.partners)&&void 0!==o?o:[]))u(e);return c},[b,y,m]),M=(0,a.useMemo)(()=>{let e=new Set(h.filter(e=>!C.has(e.id)).map(e=>e.id));return{ppl:h.filter(t=>e.has(t.id)),mar:x.filter(t=>e.has(t.partner_a)&&e.has(t.partner_b)),pc:p.filter(t=>e.has(t.parent_id)&&e.has(t.child_id))}},[h,x,p,C]),{nodeById:S}=(0,a.useMemo)(()=>i(M.ppl,M.mar,M.pc),[M]),{nodes:E,positionById:A}=(0,a.useMemo)(()=>(function(e,t,l){var r,a,n,s,i,d,o,c,u,h,x,p,v,m;let f=null!==(r=null==l?void 0:l.levelGap)&&void 0!==r?r:220;null==l||l.nodeGap;let g=null!==(a=null==l?void 0:l.cardWidth)&&void 0!==a?a:140,b=null!==(n=null==l?void 0:l.blockMargin)&&void 0!==n?n:30,j=new Map;for(let[e,l]of t)j.set(e,(null!==(s=l.generation)&&void 0!==s?s:0)|0);let y=new Map;for(let e of t.values())for(let t of e.partners)y.has(e.id)||y.set(e.id,[]),y.has(t)||y.set(t,[]),y.get(e.id).push(t),y.get(t).push(e.id);let w=new Set;for(let e of t.keys()){if(w.has(e))continue;let t=[e];w.add(e);let l=[];for(;t.length;){let e=t.pop();for(let r of(l.push(e),null!==(i=y.get(e))&&void 0!==i?i:[]))w.has(r)||(w.add(r),t.push(r))}let r=Math.min(...l.map(e=>{var t;return null!==(t=j.get(e))&&void 0!==t?t:0}));for(let e of l)j.set(e,r)}let _=new Map;for(let[e]of t){let t=null!==(d=j.get(e))&&void 0!==d?d:0;_.has(t)||_.set(t,[]),_.get(t).push(e)}let N=Array.from(_.keys()).sort((e,t)=>e-t),k=new Map,C=e=>{var l,r;let a=null!==(r=null===(l=t.get(e))||void 0===l?void 0:l.birth_date)&&void 0!==r?r:null;if(null===a)return Number.MAX_SAFE_INTEGER;let n=String(a).match(/\d{1,4}/),s=n?parseInt(n[0],10):Number.MAX_SAFE_INTEGER;return Number.isFinite(s)?s:Number.MAX_SAFE_INTEGER},M=e=>{var l,r;let a=new Set;for(let n of e)(null!==(r=null===(l=t.get(n))||void 0===l?void 0:l.parents)&&void 0!==r?r:[]).forEach(e=>a.add(e));let n=Array.from(a).map(e=>{var t;return null===(t=k.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);return 0===n.length?0:n.reduce((e,t)=>e+t,0)/n.length};for(let e of N){let r=e*f,a=_.get(e),n=new Set,s=[];for(let r of a){if(n.has(r))continue;n.add(r);let a=(null!==(c=null===(o=t.get(r))||void 0===o?void 0:o.partners)&&void 0!==c?c:[]).find(t=>{var l;return(null!==(l=j.get(t))&&void 0!==l?l:0)===e});if(a&&!n.has(a)){n.add(a);let e=t.get(r),i=t.get(a),d="M"===e.gender?e.id:"M"===i.gender?i.id:e.id,o=e.id===d?i.id:e.id,c=d<o?"".concat(d,"|").concat(o):"".concat(o,"|").concat(d),v=Math.min(C(d),C(o)),m=(null!==(x=null===(u=t.get(d))||void 0===u?void 0:u.parents)&&void 0!==x?x:[]).concat(null!==(p=null===(h=t.get(o))||void 0===h?void 0:h.parents)&&void 0!==p?p:[]).sort().join("|")||"single:".concat(d),f=M([d,o]);(null==l?void 0:l.collapsedCouples)&&l.collapsedCouples.has(c)?s.push({ids:[d],rank:v,parentsKey:m,weight:f}):s.push({ids:[d,o],rank:v,parentsKey:m,weight:f})}else{let e=C(r),l=(null!==(m=null===(v=t.get(r))||void 0===v?void 0:v.parents)&&void 0!==m?m:[]).sort().join("|")||"single:".concat(r),a=M([r]);s.push({ids:[r],rank:e,parentsKey:l,weight:a})}}let i=new Map;for(let e of s)i.has(e.parentsKey)||i.set(e.parentsKey,[]),i.get(e.parentsKey).push(e);let d=Array.from(i.entries()).sort((e,t)=>e[1].reduce((e,t)=>e+t.weight,0)/e[1].length-t[1].reduce((e,t)=>e+t.weight,0)/t[1].length),y=[],w=e=>{var l,r;let a=t.get(e);return"".concat(null!==(l=null==a?void 0:a.last_name)&&void 0!==l?l:""," ").concat(null!==(r=null==a?void 0:a.first_name)&&void 0!==r?r:"").toLowerCase()};for(let[,e]of d)e.sort((e,l)=>{if(e.rank!==l.rank)return e.rank-l.rank;let r=e=>{var l,r;let a=new Set;for(let n of e)(null!==(r=null===(l=t.get(n))||void 0===l?void 0:l.children)&&void 0!==r?r:[]).forEach(e=>a.add(e));return 0===a.size?Number.MAX_SAFE_INTEGER:Math.min(...Array.from(a).map(e=>C(e)))},a=r(e.ids),n=r(l.ids);if(a!==n)return a-n;let s=e.ids[0],i=l.ids[0];return w(s).localeCompare(w(i))}),y.push(...e);let N=0;for(let t of y){let l=2===t.ids.length?150+g:g,a=N+l/2;if(2===t.ids.length){let[l,n]=t.ids,s=a-75,i=a+75;k.set(l,{id:l,x:s,y:r,depth:e}),k.set(n,{id:n,x:i,y:r,depth:e})}else{let l=t.ids[0];k.set(l,{id:l,x:a,y:r,depth:e})}N+=l+b}let S=a.map(e=>{var t,l;return null!==(l=null===(t=k.get(e))||void 0===t?void 0:t.x)&&void 0!==l?l:0}),E=(Math.min(...S)+Math.max(...S))/2;for(let e of a){let t=k.get(e);t.x-=E}}return{nodes:Array.from(k.values()),positionById:k}})(0,S,{levelGap:220,nodeGap:220,cardWidth:140,blockMargin:40}),[[],S]),[D,I]=(0,a.useState)(.8),[L,z]=(0,a.useState)({x:300,y:160}),[P,F]=(0,a.useState)(!0),U=(0,a.useMemo)(()=>{let e=new Set(Array.from(m.values()).filter(e=>{var t;return(null!==(t=e.generation)&&void 0!==t?t:0)===1}).map(e=>e.id)),t=new Set;for(let l of x)e.has(l.partner_a)&&e.has(l.partner_b)&&t.add(k(l.partner_a,l.partner_b));let l=new Set;for(let e of m.values()){var r,a,n,s,i;if((null!==(n=e.generation)&&void 0!==n?n:0)!==1)continue;let t=(null!==(s=null===(r=e.partners)||void 0===r?void 0:r.length)&&void 0!==s?s:0)>0,d=(null!==(i=null===(a=e.children)||void 0===a?void 0:a.length)&&void 0!==i?i:0)>0;!t&&d&&l.add(e.id)}return{coupleKeys:t,singleIds:l}},[m,x]),q=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(q.current)return;let e=e=>(null!=e?e:"").toLowerCase().trim(),t=(t,l)=>{let r=e(t),a=e(l),n=Array.from(m.values()).find(t=>e(t.first_name||t.preferred_name)===r&&e(t.last_name)===a);return(null==n?void 0:n.id)||null},l=t("to dung","tran"),r=t("bao hue","chau"),{coupleKeys:a,singleIds:n}=U,s=l&&r?k(l,r):null,i=new Set;for(let e of a)s&&e===s||i.add(e);let d=new Set(n);j(i),w(d),q.current=!0},[m,x]);let G=()=>{let{coupleKeys:e,singleIds:t}=U;j(new Set(e)),w(new Set(t))},X=()=>{j(new Set),w(new Set)},R=(0,a.useMemo)(()=>b.size>0||y.size>0,[b.size,y.size]),T=(0,a.useMemo)(()=>"undefined"!=typeof navigator&&/iP(hone|ad|od)/i.test(navigator.userAgent),[]),B=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=B.current;if(!e)return;let t=e=>{(e.touches.length>=2||W.current)&&e.preventDefault()},l=e=>{e.touches.length>=2&&e.preventDefault()};return e.addEventListener("touchmove",t,{passive:!1}),e.addEventListener("touchstart",l,{passive:!1}),()=>{e.removeEventListener("touchmove",t),e.removeEventListener("touchstart",l)}},[]);let O=e=>{var t,l;let r=null!==(l=null===(t=S.get(e))||void 0===t?void 0:t.parents)&&void 0!==l?l:[];if(r.length<2)return!1;let[a,n]=r,s=k(a,n);return b.has(s)},W=(0,a.useRef)(!1),Y=(0,a.useRef)({x:0,y:0}),J=e=>{W.current=!0,Y.current={x:e.clientX,y:e.clientY}},K=(0,a.useRef)(new Map),Z=(0,a.useRef)(null),H=(0,a.useRef)(null),Q=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),V=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}),$=e=>{if("mouse"!==e.pointerType)try{var t,l;null===(t=(l=e.currentTarget).setPointerCapture)||void 0===t||t.call(l,e.pointerId)}catch(e){}if(K.current.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===K.current.size){let[e,t]=Array.from(K.current.values()),l=Q(e,t),r=V(e,t),a={...L},n={x:(r.x-a.x)/D,y:(r.y-a.y)/D};Z.current={dist:l,scale:D,translate:a,worldOrigin:n,screenOrigin:r}}1===K.current.size&&(W.current=!1,H.current={x:e.clientX,y:e.clientY})},ee=e=>{let t=K.current;if(t.has(e.pointerId)){if(t.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===t.size&&Z.current){let[e,l]=Array.from(t.values()),r=Q(e,l),a=V(e,l),n=Z.current,s=r/(n.dist||1),i=Math.min(2,Math.max(.3,n.scale*s)),d=n.worldOrigin,o={x:a.x-d.x*i,y:a.y-d.y*i};I(i),z(o)}else if(1===t.size){let l=t.get(e.pointerId);if(!W.current){let e=H.current;if(e){if(!(Math.hypot(l.x-e.x,l.y-e.y)>4))return;W.current=!0,Y.current={x:l.x,y:l.y}}}if(W.current){let e=l.x-Y.current.x,t=l.y-Y.current.y;z(l=>({x:l.x+e,y:l.y+t})),Y.current={x:l.x,y:l.y}}}}},et=e=>{K.current.delete(e),K.current.size<2&&(Z.current=null),0===K.current.size&&(W.current=!1,H.current=null)},el=e=>et(e.pointerId),er=e=>et(e.pointerId);(0,a.useMemo)(()=>{let e=f.trim().toLowerCase();return e?Array.from(S.values()).filter(t=>{var l,r,a;return"".concat(null!==(r=null!==(l=t.preferred_name)&&void 0!==l?l:t.first_name)&&void 0!==r?r:""," ").concat(null!==(a=t.last_name)&&void 0!==a?a:"").toLowerCase().includes(e)}):[]},[f,S]);let ea=(e,t)=>{let l=A.get(e);if(!l)return;let r="number"==typeof t?Math.max(.3,Math.min(2,t)):D;I(r);let a={w:window.innerWidth,h:window.innerHeight};z({x:a.w/2-l.x*r,y:a.h/2-l.y*r})},en=e=>{var t,l;let r=null!==(l=null===(t=m.get(e))||void 0===t?void 0:t.partners)&&void 0!==l?l:[];if(0===r.length){w(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l});return}j(t=>{let l=new Set(t),a=r.every(t=>l.has(k(e,t)));for(let t of r){let r=k(e,t);a?l.delete(r):l.add(r)}return l})},es=()=>{if(0===E.length)return;let e=E.map(e=>e.x),t=E.map(e=>e.y),l=Math.min(...e)-70,r=Math.max(...e)+70,a=Math.min(...t)-75,n=Math.max(...t)+75,s=window.innerWidth-(P?320:0),i=window.innerHeight-40,d=Math.min(2,Math.max(.3,.9*Math.min(s/(r-l),i/(n-a))));I(d),z({x:s/2+(P?320:0)/2-(l+r)/2*d,y:i/2-(a+n)/2*d})},[ei,ed]=(0,a.useState)(null),eo=ei&&null!==(t=S.get(ei))&&void 0!==t?t:null;(0,u.useRouter)();let ec=(0,a.useMemo)(()=>o(),[]),[eu,eh]=(0,a.useState)({}),[ex,ep]=(0,a.useState)(""),[ev,em]=(0,a.useState)(""),[ef,eg]=(0,a.useState)("");(0,a.useEffect)(()=>{var e,t,l,r,a,n,s,i,d,o,c,u,h,x,p,v,f;if(!eo)return;eh({first_name:null!==(l=eo.first_name)&&void 0!==l?l:"",last_name:null!==(r=eo.last_name)&&void 0!==r?r:"",preferred_name:null!==(a=eo.preferred_name)&&void 0!==a?a:"",gender:null!==(n=eo.gender)&&void 0!==n?n:null,birth_date:null!==(s=eo.birth_date)&&void 0!==s?s:"",birth_place:null!==(i=eo.birth_place)&&void 0!==i?i:"",death_date:null!==(d=eo.death_date)&&void 0!==d?d:"",death_place:null!==(o=eo.death_place)&&void 0!==o?o:"",status:null!==(c=eo.status)&&void 0!==c?c:null,phone:null!==(u=eo.phone)&&void 0!==u?u:"",facebook:null!==(h=eo.facebook)&&void 0!==h?h:"",photo:null!==(x=eo.photo)&&void 0!==x?x:"",generation:null!==(p=eo.generation)&&void 0!==p?p:null});let g=null!==(v=null===(e=m.get(eo.id))||void 0===e?void 0:e.parents)&&void 0!==v?v:[],b=g.find(e=>{var t;return(null===(t=m.get(e))||void 0===t?void 0:t.gender)==="M"})||g[0]||"",j=g.find(e=>{var t;return(null===(t=m.get(e))||void 0===t?void 0:t.gender)==="F"})||(g.length>1?g[1]:"")||"";ep(b||""),em(j||""),eg((null!==(f=null===(t=m.get(eo.id))||void 0===t?void 0:t.partners)&&void 0!==f?f:[])[0]||"")},[eo]);let eb=async()=>{if(!eo)return;let e={...eu};try{var t,l,r,a;await ec.from("people").update(e).eq("id",eo.id);let n=null!==(r=null===(t=m.get(eo.id))||void 0===t?void 0:t.parents)&&void 0!==r?r:[],s=n.find(e=>{var t;return(null===(t=m.get(e))||void 0===t?void 0:t.gender)==="M"})||n[0]||"",i=n.find(e=>{var t;return(null===(t=m.get(e))||void 0===t?void 0:t.gender)==="F"})||(n.length>1?n[1]:"")||"",d=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),o=eo.id;(ex||"")!==(s||"")&&(s&&await ec.from("parent_child").delete().eq("parent_id",s).eq("child_id",o),ex&&await ec.from("parent_child").insert({id:d(),parent_id:ex,child_id:o})),(ev||"")!==(i||"")&&(i&&await ec.from("parent_child").delete().eq("parent_id",i).eq("child_id",o),ev&&await ec.from("parent_child").insert({id:d(),parent_id:ev,child_id:o}));let c=(null!==(a=null===(l=m.get(eo.id))||void 0===l?void 0:l.partners)&&void 0!==a?a:[])[0]||"";(ef||"")!==(c||"")&&(c&&(await ec.from("marriages").delete().eq("partner_a",o).eq("partner_b",c),await ec.from("marriages").delete().eq("partner_a",c).eq("partner_b",o)),ef&&await ec.from("marriages").insert({id:d(),partner_a:o,partner_b:ef})),ed(null),v&&await v()}catch(e){console.error(e)}},[ej,ey]=(0,a.useState)(!1),ew={gender:"M",status:"Living",generation:2},[e_,eN]=(0,a.useState)(ew),[ek,eC]=(0,a.useState)(""),[eM,eS]=(0,a.useState)(""),[eE,eA]=(0,a.useState)(""),eD=(0,a.useMemo)(()=>Array.from(m.values()),[m]),eI=async()=>{if(!e_.first_name||!e_.last_name){alert("First and last name are required");return}if(!e_.status){alert("Status is required");return}if("number"!=typeof e_.generation||isNaN(e_.generation)){alert("Generation is required");return}if(!e_.gender){alert("Gender is required");return}try{let e="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),{data:t,error:l}=await ec.from("people").insert({id:e,...e_}).select().single();if(l)throw l;let r=(null==t?void 0:t.id)||e,a=[],n=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2));if(ek&&a.push({id:n(),parent_id:ek,child_id:r}),eM&&a.push({id:n(),parent_id:eM,child_id:r}),a.length){let{error:e}=await ec.from("parent_child").insert(a);if(e)throw e}if(eE){let{error:e}=await ec.from("marriages").insert({id:n(),partner_a:r,partner_b:eE});if(e)throw e}ey(!1),eC(""),eS(""),eA(""),eN(ew),v&&await v()}catch(e){console.error(e)}};return(0,a.useEffect)(()=>{if(!eo)return;let e=e=>{"Escape"===e.key&&ed(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eo]),(0,a.useEffect)(()=>{E.length>0&&es()},[E.length]),(0,a.useEffect)(()=>{window.innerWidth<1024&&F(!1)},[]),(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[P&&(0,r.jsxs)("aside",{className:"w-80 border-r border-slate-800 bg-slate-900/70 glass p-4 space-y-4 overflow-y-auto relative",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 bg-slate-900/90 pt-2 pb-3 space-y-2",children:[(0,r.jsxs)("div",{className:"px-1 text-lg font-semibold text-slate-100",children:["Family Tree ",(0,r.jsx)("span",{className:"text-pink-400",children:"❤"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(s.Z,{className:"h-5 w-5 text-slate-400"}),(0,r.jsx)("input",{className:"w-full rounded-md bg-slate-800/70 border border-slate-700 px-3 py-2 text-slate-100 placeholder:text-slate-400 focus:outline-none focus:ring",placeholder:"Search by name...",value:f,onChange:e=>g(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"sticky top-20 flex items-center gap-2 z-10 bg-slate-900/90 py-2",children:[(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>I(e=>Math.min(2,e+.1)),children:"+"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>I(e=>Math.max(.3,e-.1)),children:"-"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:es,children:"Reset"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>{R?X():G()},children:R?"Expand all":"Collapse all"})]}),Array.from(new Set(h.map(e=>{var t;return null!==(t=e.generation)&&void 0!==t?t:0}))).sort((e,t)=>e-t).map(e=>{let t=h.filter(t=>{var l;return(null!==(l=t.generation)&&void 0!==l?l:0)===e}).sort((e,t)=>{var l,r,a,n,s,i,d,o,c,u;let h=(null!==(d=null===(l=S.get(e.id))||void 0===l?void 0:l.parents)&&void 0!==d?d:[]).slice().sort().join("|"),x=(null!==(o=null===(r=S.get(t.id))||void 0===r?void 0:r.parents)&&void 0!==o?o:[]).slice().sort().join("|"),p=(null!==(c=null===(n=S.get(e.id))||void 0===n?void 0:null===(a=n.parents)||void 0===a?void 0:a.length)&&void 0!==c?c:0)>0?0:1,v=(null!==(u=null===(i=S.get(t.id))||void 0===i?void 0:null===(s=i.parents)||void 0===s?void 0:s.length)&&void 0!==u?u:0)>0?0:1;return p!==v?p-v:h!==x?h.localeCompare(x):(null!=e.birth_date?parseInt(String(e.birth_date),10):Number.MAX_SAFE_INTEGER)-(null!=t.birth_date?parseInt(String(t.birth_date),10):Number.MAX_SAFE_INTEGER)}).map(e=>e.id);return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Generation ",e]})}),t.map(e=>{var t;let l=S.get(e);if(!l)return null;let a=(l.preferred_name||l.first_name||"")+" "+(l.last_name||"");return f&&!a.toLowerCase().includes(f.toLowerCase())?null:(0,r.jsxs)("button",{className:"w-full flex items-center gap-3 rounded px-2 py-2 hover:bg-slate-800/70",onClick:()=>{ea(e,1.2),_&&ed(e)},children:[l.photo?(0,r.jsx)("img",{src:l.photo,alt:a,className:"h-9 w-9 rounded-full object-cover"}):(0,r.jsx)("div",{className:"h-9 w-9 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm text-slate-100",children:a}),(0,r.jsx)("div",{className:"text-[11px] text-slate-400",children:null!==(t=l.status)&&void 0!==t?t:"Unknown"})]})]},e)})]},e)}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-4",children:"Tip: drag to pan, scroll to zoom. Click a name to center."})]}),(0,r.jsxs)("main",{className:"flex-1 relative bg-gradient-to-b from-slate-900 to-slate-950",onPointerDown:$,onPointerMove:ee,onPointerUp:el,onPointerCancel:er,style:{touchAction:"none"},children:[(0,r.jsx)("button",{className:"absolute left-2 top-2 z-50 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40",onClick:()=>{F(e=>!e),setTimeout(es,50)},children:P?"Hide sidebar":"Show sidebar"}),(0,r.jsxs)("svg",{ref:B,className:"absolute inset-0 w-full h-full",onWheel:e=>{I(Math.min(2,Math.max(.3,D-.001*e.deltaY)))},onMouseDown:e=>{e.target.closest("[data-node]")||J(e)},onMouseMove:e=>{if(!W.current)return;let t=e.clientX-Y.current.x,l=e.clientY-Y.current.y;z(e=>({x:e.x+t,y:e.y+l})),Y.current={x:e.clientX,y:e.clientY}},onMouseUp:()=>{W.current=!1},onPointerDown:$,onPointerMove:ee,onPointerUp:el,onPointerCancel:er,style:{touchAction:T?"manipulation":"none"},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:(0,r.jsx)("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#475569"})})}),(0,r.jsxs)("g",{transform:"translate(".concat(L.x,", ").concat(L.y,") scale(").concat(D,")"),children:[(()=>{let e=new Set;for(let t of M.mar){let l=t.partner_a<t.partner_b?t.partner_a:t.partner_b,r=t.partner_a<t.partner_b?t.partner_b:t.partner_a;e.add("".concat(l,"|").concat(r))}let t=new Map;for(let e of p)t.has(e.child_id)||t.set(e.child_id,new Set),t.get(e.child_id).add(e.parent_id);let l=[],a=new Set;for(let[r,n]of t){if(O(r)){a.add(r);continue}let t=Array.from(n);if(t.length>=2){let n=t[0],s=t[1],i=n<s?n:s,d=n<s?s:n;if(e.has("".concat(i,"|").concat(d))){let e=A.get(i),t=A.get(d),n=A.get(r);if(e&&t&&n){let s=(e.x+t.x)/2,o=Math.max(e.y,t.y)+75,c=n.x,u=n.y-75;l.push({key:"".concat(i,"-").concat(d,"-").concat(r),x1:s,y1:o,x2:c,y2:u}),a.add(r)}}}}for(let e of p){if(O(e.child_id)||a.has(e.child_id))continue;let t=A.get(e.parent_id),r=A.get(e.child_id);if(!t||!r)continue;let n=t.x,s=t.y+75,i=r.x,d=r.y-75;l.push({key:e.id,x1:n,y1:s,x2:i,y2:d})}return l.map(e=>(0,r.jsx)("path",{d:"M ".concat(e.x1," ").concat(e.y1," C ").concat(e.x1," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat(e.y2),stroke:"#475569",strokeWidth:"3",fill:"none",markerEnd:"url(#arrow)"},e.key))})(),M.mar.map(e=>{let t=A.get(e.partner_a),l=A.get(e.partner_b);if(!t||!l)return null;let a=t.y;return(0,r.jsx)("path",{d:"M ".concat(t.x+70," ").concat(a," L ").concat(l.x-70," ").concat(a),stroke:"#fb7185",strokeWidth:"3.5",fill:"none",strokeDasharray:"6 6"},e.id)}),(()=>{let e=Array.from(new Set(E.map(e=>e.depth))).sort((e,t)=>e-t),t=Math.min(...E.map(e=>e.x))-200,l=Math.max(...E.map(e=>e.x))+200;return e.map(e=>{let a=220*e;return(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:t,y1:a,x2:l,y2:a,stroke:"#1f2937",strokeDasharray:"6 10",strokeWidth:2}),(0,r.jsx)("rect",{x:t,y:a-20,width:120,height:28,rx:8,fill:"#0f172a",stroke:"#1f2937"}),(0,r.jsxs)("text",{x:t+60,y:a-2,fill:"#e2e8f0",fontSize:12,textAnchor:"middle",children:["Generation ",e]})]},e)})})(),Array.from(new Map(E.map(e=>[e.id,e])).values()).filter(e=>!O(e.id)).map(e=>{var t,l,a,s;let i=S.get(e.id),d="M"===i.gender?"bg-male/90":"F"===i.gender?"bg-female/90":"bg-neutral/80",o=(i.status||"").toLowerCase(),c=e.x-70,u=e.y-75,h=m.get(i.id)||i,x=null!==(l=null==h?void 0:h.partners)&&void 0!==l?l:[],p=x.length>0||(null!==(a=null==h?void 0:null===(t=h.children)||void 0===t?void 0:t.length)&&void 0!==a?a:0)>0,v="none";if(p){if(x.length>0){let e=k(i.id,x[0]);v=b.has(e)?"collapsed":"expanded"}else v=y.has(i.id)?"collapsed":"expanded"}if(T){let t="M"===i.gender?"rgba(56,189,248,0.9)":"F"===i.gender?"rgba(244,114,182,0.9)":"rgba(148,163,184,0.8)",l=e.x-70,a=e.y-75,n="clip-".concat(e.id);return(0,r.jsxs)("g",{"data-node":!0,onClick:()=>{_?ed(e.id):en(e.id)},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:n,children:(0,r.jsx)("circle",{cx:e.x,cy:e.y-32,r:26})})}),(0,r.jsx)("rect",{x:l,y:a,rx:16,ry:16,width:140,height:150,fill:t,stroke:"rgba(255,255,255,0.15)"}),"none"!==v&&(0,r.jsx)("text",{x:l+140-10,y:a+14,textAnchor:"end",fontSize:16,fill:"#fff",children:"collapsed"===v?"+":"−"}),i.photo?(0,r.jsx)("image",{href:i.photo,x:e.x-26,y:e.y-58,width:52,height:52,clipPath:"url(#".concat(n,")"),preserveAspectRatio:"xMidYMid slice"}):(0,r.jsx)("text",{x:e.x,y:e.y-32,textAnchor:"middle",fontSize:24,children:"\uD83D\uDC64"}),(0,r.jsx)("text",{x:e.x,y:e.y-2,textAnchor:"middle",fontSize:11,fill:"#fff",fontWeight:600,children:(i.preferred_name||i.first_name)+" "+(i.last_name||"")}),(0,r.jsx)("text",{x:e.x,y:e.y+12,textAnchor:"middle",fontSize:9,fill:"deceased"===o?"#f87171":"living"===o?"#22c55e":"#cbd5e1",opacity:.9,children:i.status?String(i.status).toLowerCase():"unknown"}),i.children.length>0&&(0,r.jsxs)("text",{x:e.x,y:e.y+26,textAnchor:"middle",fontSize:10,fill:"#fff",children:["\uD83D\uDC76 ",i.children.length]})]},e.id)}return(0,r.jsx)("foreignObject",{x:c,y:u,width:140,height:150,"data-node":!0,onPointerDown:e=>{e.stopPropagation()},onPointerMove:e=>{e.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},onPointerCancel:e=>{e.stopPropagation()},children:(0,r.jsxs)("div",{className:(0,n.W)("rounded-2xl shadow-card text-white flex flex-col items-center justify-center h-full px-3 py-2 cursor-pointer relative select-none",d),onClick:()=>{_?ed(e.id):en(e.id)},style:{touchAction:T?"manipulation":"none"},children:["none"!==v&&(0,r.jsx)("div",{className:"absolute top-1.5 right-2 text-lg font-semibold text-white/90 select-none pointer-events-none",children:"collapsed"===v?"+":"−"}),(0,r.jsx)("div",{className:"relative mb-2",children:i.photo?(0,r.jsx)("img",{src:i.photo,alt:null!==(s=i.first_name)&&void 0!==s?s:"",className:"h-24 w-24 rounded-full object-cover ring-2 ring-white/20"}):(0,r.jsx)("div",{className:"h-24 w-24 rounded-full bg-black/20 grid place-items-center text-3xl",children:"\uD83D\uDC64"})}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold leading-4",children:[i.preferred_name||i.first_name," ",i.last_name]}),(0,r.jsx)("div",{className:(0,n.W)("text-[10px] opacity-90","deceased"===o?"text-deceased":"living"===o?"text-living":"text-slate-300"),children:i.status?String(i.status).toLowerCase():"unknown"}),(0,r.jsx)("div",{className:"flex items-center justify-center gap-2 mt-1 text-white/90",children:i.children.length>0&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 text-[10px]",children:[(0,r.jsx)("span",{role:"img","aria-label":"children",children:"\uD83D\uDC76"})," ",i.children.length]})})]})]})},e.id)})]})]}),(0,r.jsxs)("div",{className:"absolute left-2 top-2 z-50 flex flex-col gap-2",children:[(0,r.jsx)("button",{className:"w-40 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{F(e=>!e),setTimeout(es,50)},children:P?"Hide sidebar":"Show sidebar"}),(0,r.jsx)("button",{className:"w-40 rounded bg-slate-800 hover:bg-slate-700 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>N(!_),children:_?"Exit edit mode":"Edit mode"}),(0,r.jsx)("button",{className:"w-40 rounded bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{eN(ew),eC(""),eS(""),eA(""),ey(!0)},children:"Add person"})]}),eo&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>ed(null),children:(0,r.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[800px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 p-5 border-b border-slate-800",children:[eo.photo?(0,r.jsx)("img",{src:eo.photo,alt:"",className:"h-20 w-20 rounded-full object-cover ring-2 ring-white/10"}):(0,r.jsx)("div",{className:"h-20 w-20 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"text-xl font-semibold",children:[eo.preferred_name||eo.first_name," ",eo.last_name]}),(0,r.jsx)("div",{className:"text-sm text-slate-400 capitalize",children:(eo.status||"").toString()})]}),(0,r.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ed(null),children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"First name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.first_name||"",onChange:e=>eh(t=>({...t,first_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Last name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.last_name||"",onChange:e=>eh(t=>({...t,last_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.preferred_name||"",onChange:e=>eh(t=>({...t,preferred_name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Gender"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.gender||"",onChange:e=>eh(t=>({...t,gender:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"M",children:"M"}),(0,r.jsx)("option",{value:"F",children:"F"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Status",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:eu.status||"",onChange:e=>eh(t=>({...t,status:e.target.value})),children:[(0,r.jsx)("option",{value:"Living",children:"Living"}),(0,r.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.birth_date||"",onChange:e=>eh(t=>({...t,birth_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.birth_place||"",onChange:e=>eh(t=>({...t,birth_place:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Death date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.death_date||"",onChange:e=>eh(t=>({...t,death_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Death place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.death_place||"",onChange:e=>eh(t=>({...t,death_place:e.target.value}))})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Generation",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:String(null!==(l=eu.generation)&&void 0!==l?l:""),onChange:e=>eh(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null})),children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ex,onChange:e=>ep(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ev,onChange:e=>em(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ef,onChange:e=>eg(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Phone"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.phone||"",onChange:e=>eh(t=>({...t,phone:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Facebook"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.facebook||"",onChange:e=>eh(t=>({...t,facebook:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.photo||"",onChange:e=>eh(t=>({...t,photo:e.target.value}))})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:eb,children:"Save"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ed(null),children:"Cancel"})]})]})]}),(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Family"}),(0,r.jsx)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:(0,r.jsx)("svg",{width:"100%",height:"240",viewBox:"0 0 640 240",children:(()=>{var e,t,l;let a=(null!==(e=eo.parents)&&void 0!==e?e:[]).map(e=>S.get(e)).filter(Boolean),n=(null!==(t=eo.partners)&&void 0!==t?t:[]).map(e=>S.get(e)).filter(Boolean),s=(null!==(l=eo.children)&&void 0!==l?l:[]).map(e=>S.get(e)).filter(Boolean),i=a.map((e,t)=>160+t*(a.length>1?320:0)),d=n.map((e,t)=>320+(t+1)*140),o=s.length>1?s.map((e,t)=>100+440/(s.length-1)*t):[320],c=[];return a.forEach((e,t)=>{c.push((0,r.jsxs)("text",{x:i[t],y:30,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"pt-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(i[t]," ").concat(36," L ").concat(320," ").concat(106),stroke:"#64748b"},"p-line-".concat(e.id)))}),c.push((0,r.jsx)("circle",{cx:320,cy:120,r:12,fill:"#38bdf8"},"me")),c.push((0,r.jsxs)("text",{x:320,y:148,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[eo.preferred_name||eo.first_name," ",eo.last_name||""]},"me-t")),n.forEach((e,t)=>{c.push((0,r.jsx)("circle",{cx:d[t],cy:120,r:10,fill:"#f472b6"},"sp-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(332," ").concat(120," L ").concat(d[t]-12," ").concat(120),stroke:"#fb7185",strokeDasharray:"6 4"},"m-".concat(e.id)))}),s.forEach((e,t)=>{c.push((0,r.jsxs)("text",{x:o[t],y:210,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"ch-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(320," ").concat(134," L ").concat(o[t]," ").concat(196),stroke:"#64748b"},"c-line-".concat(e.id)))}),c})()})})]})]})}),ej&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>ey(!1),children:(0,r.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[820px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-slate-800",children:[(0,r.jsx)("div",{className:"text-lg font-semibold",children:"Add new person"}),(0,r.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ey(!1),children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["First name",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.first_name||"",onChange:e=>eN(t=>({...t,first_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Last name",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.last_name||"",onChange:e=>eN(t=>({...t,last_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.preferred_name||"",onChange:e=>eN(t=>({...t,preferred_name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Gender",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.gender||"",onChange:e=>eN(t=>({...t,gender:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"M",children:"M"}),(0,r.jsx)("option",{value:"F",children:"F"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Status",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.status||"",onChange:e=>eN(t=>({...t,status:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"Living",children:"Living"}),(0,r.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.birth_date||"",onChange:e=>eN(t=>({...t,birth_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.birth_place||"",onChange:e=>eN(t=>({...t,birth_place:e.target.value}))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.photo||"",onChange:e=>eN(t=>({...t,photo:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Generation",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:String(null!==(d=e_.generation)&&void 0!==d?d:""),onChange:e=>eN(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null})),children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ek,onChange:e=>eC(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eM,onChange:e=>eS(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eE,onChange:e=>eA(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:eI,children:"Create"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ey(!1),children:"Cancel"})]})]})]})]})})]})]})}var x=l(257);function p(){let[e,t]=(0,a.useState)(null),[l,n]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),d=async()=>{var e,l,r;if("true"===x.env.NEXT_PUBLIC_USE_JSON_FALLBACK||"true"===x.env.USE_JSON_FALLBACK)try{let e=await fetch("/data/sample.json",{cache:"no-store"});if(e.ok){let l=await e.json();t(l.people||[]),n(l.marriages||[]),i(l.parent_child||[]);return}}catch(e){}let a=o(),[s,d,c]=await Promise.all([a.from("people").select("*").returns(),a.from("marriages").select("*").returns(),a.from("parent_child").select("*").returns()]);t(null!==(e=s.data)&&void 0!==e?e:[]),n(null!==(l=d.data)&&void 0!==l?l:[]),i(null!==(r=c.data)&&void 0!==r?r:[])};return((0,a.useEffect)(()=>{d()},[]),e&&l&&s)?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(h,{people:e,marriages:l,parentChild:s,onChanged:d}),(0,r.jsx)("div",{id:"modal-root",className:"fixed inset-0 pointer-events-none"})]}):(0,r.jsx)("div",{className:"min-h-screen grid place-items-center text-slate-300",children:"Loading…"})}},3538:function(e,t,l){"use strict";l.d(t,{EditModeProvider:function(){return s},S:function(){return i}});var r=l(7437),a=l(2265);let n=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[l,s]=(0,a.useState)(!1);return(0,r.jsx)(n.Provider,{value:{editMode:l,setEditMode:s},children:t})}function i(){let e=(0,a.useContext)(n);if(!e)throw Error("useEditMode must be used within EditModeProvider");return e}}},function(e){e.O(0,[156,971,117,744],function(){return e(e.s=1169)}),_N_E=e.O()}]);