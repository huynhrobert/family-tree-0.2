(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5282:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=5282,e.exports=t},1169:function(e,t,l){Promise.resolve().then(l.bind(l,7701))},7701:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return p}});var r=l(7437),n=l(2265),a=l(1994),s=l(8193);function i(e,t,l){var r,n,a;let s=new Map(e.map(e=>[e.id,e])),i=new Map;for(let t of e)i.set(t.id,{...t,children:[],partners:[]});for(let e of t)null===(r=i.get(e.partner_a))||void 0===r||r.partners.push(e.partner_b),null===(n=i.get(e.partner_b))||void 0===n||n.partners.push(e.partner_a);for(let e of l){null===(a=i.get(e.parent_id))||void 0===a||a.children.push(e.child_id);let t=i.get(e.child_id);t&&(t.parents||(t.parents=[]),t.parents.push(e.parent_id))}return{nodeById:i,personById:s}}var d=l(1388);let o=()=>(0,d.createBrowserClient)("https://knqbdesytcdyzuxclnoy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtucWJkZXN5dGNkeXp1eGNsbm95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMTkxNjEsImV4cCI6MjA2OTY5NTE2MX0.z9dGc6cn3MXAUagOY8bJm9-XKgqgiZS8bk81dz70uf8");var c=l(3538),u=l(9376);function h(e){var t,l,d;let{people:h,marriages:x,parentChild:p,onChanged:f}=e,{nodeById:v}=(0,n.useMemo)(()=>i(h,x,p),[h,x,p]),[g,m]=(0,n.useState)(""),[b,j]=(0,n.useState)(new Set),[y,w]=(0,n.useState)(new Set),{editMode:_,setEditMode:N}=(0,c.S)(),k=(e,t)=>e<t?"".concat(e,"|").concat(t):"".concat(t,"|").concat(e),M=(0,n.useMemo)(()=>{var e,t,l,r,n,a,s,i,d,o;let c=new Set,u=e=>{let t=[e];for(;t.length;){var l,r,n,a;let e=t.pop();if(!c.has(e)){for(let r of(c.add(e),null!==(n=null===(l=v.get(e))||void 0===l?void 0:l.children)&&void 0!==n?n:[]))t.push(r);for(let l of null!==(a=null===(r=v.get(e))||void 0===r?void 0:r.partners)&&void 0!==a?a:[])t.push(l)}}};for(let s of b){let[i,d]=s.split("|");for(let s of new Set([...null!==(l=null===(e=v.get(i))||void 0===e?void 0:e.children)&&void 0!==l?l:[],...null!==(r=null===(t=v.get(d))||void 0===t?void 0:t.children)&&void 0!==r?r:[]]))for(let e of(u(s),null!==(a=null===(n=v.get(s))||void 0===n?void 0:n.partners)&&void 0!==a?a:[]))u(e)}for(let e of y)for(let t of null!==(i=null===(s=v.get(e))||void 0===s?void 0:s.children)&&void 0!==i?i:[])for(let e of(u(t),null!==(o=null===(d=v.get(t))||void 0===d?void 0:d.partners)&&void 0!==o?o:[]))u(e);return c},[b,y,v]),C=(0,n.useMemo)(()=>{let e=new Set(h.filter(e=>!M.has(e.id)).map(e=>e.id));return{ppl:h.filter(t=>e.has(t.id)),mar:x.filter(t=>e.has(t.partner_a)&&e.has(t.partner_b)),pc:p.filter(t=>e.has(t.parent_id)&&e.has(t.child_id))}},[h,x,p,M]),{nodeById:S}=(0,n.useMemo)(()=>i(C.ppl,C.mar,C.pc),[C]),{nodes:E,positionById:A}=(0,n.useMemo)(()=>(function(e,t,l){var r,n,a,s,i,d,o,c,u,h,x,p,f,v,g,m;let b=null!==(r=null==l?void 0:l.levelGap)&&void 0!==r?r:220;null==l||l.nodeGap;let j=null!==(n=null==l?void 0:l.cardWidth)&&void 0!==n?n:140,y=null!==(a=null==l?void 0:l.blockMargin)&&void 0!==a?a:30,w=new Map;for(let[e,l]of t)w.set(e,(null!==(s=l.generation)&&void 0!==s?s:0)|0);let _=new Map;for(let e of t.values())for(let t of e.partners)_.has(e.id)||_.set(e.id,[]),_.has(t)||_.set(t,[]),_.get(e.id).push(t),_.get(t).push(e.id);let N=new Set;for(let e of t.keys()){if(N.has(e))continue;let t=[e];N.add(e);let l=[];for(;t.length;){let e=t.pop();for(let r of(l.push(e),null!==(i=_.get(e))&&void 0!==i?i:[]))N.has(r)||(N.add(r),t.push(r))}let r=Math.min(...l.map(e=>{var t;return null!==(t=w.get(e))&&void 0!==t?t:0}));for(let e of l)w.set(e,r)}let k=new Map;for(let[e]of t){let t=null!==(d=w.get(e))&&void 0!==d?d:0;k.has(t)||k.set(t,[]),k.get(t).push(e)}let M=Array.from(k.keys()).sort((e,t)=>e-t),C=new Map,S=e=>{var l,r;let n=null!==(r=null===(l=t.get(e))||void 0===l?void 0:l.birth_date)&&void 0!==r?r:null;if(null===n)return Number.MAX_SAFE_INTEGER;let a=String(n).match(/\d{1,4}/),s=a?parseInt(a[0],10):Number.MAX_SAFE_INTEGER;return Number.isFinite(s)?s:Number.MAX_SAFE_INTEGER},E=e=>{var l,r;let n=new Set;for(let a of e)(null!==(r=null===(l=t.get(a))||void 0===l?void 0:l.parents)&&void 0!==r?r:[]).forEach(e=>n.add(e));let a=Array.from(n).map(e=>{var t;return null===(t=C.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);return 0===a.length?0:a.reduce((e,t)=>e+t,0)/a.length},A=(e,l)=>{let r=new Set;for(let i of e){var n,a,s;for(let e of null!==(a=null===(n=t.get(i))||void 0===n?void 0:n.parents)&&void 0!==a?a:[])(null!==(s=w.get(e))&&void 0!==s?s:0)===l-1&&r.add(e)}return 0===r.size?null:Array.from(r).sort().join("|")},D=e=>{if(!e)return 0;let t=e.split("|").filter(Boolean).map(e=>{var t;return null===(t=C.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);return 0===t.length?0:t.reduce((e,t)=>e+t,0)/t.length};for(let e of M){let r=e*b,n=k.get(e),a=new Set,s=[],i=e=>{var l,r;let n=(null!==(r=null===(l=t.get(e))||void 0===l?void 0:l.parents)&&void 0!==r?r:[]).slice().sort();return n.length>0?n.join("|"):""},d=e=>D(e);for(let r of n){if(a.has(r))continue;a.add(r);let n=(null!==(c=null===(o=t.get(r))||void 0===o?void 0:o.partners)&&void 0!==c?c:[]).find(t=>{var l;return(null!==(l=w.get(t))&&void 0!==l?l:0)===e});if(n&&!a.has(n)){a.add(n);let o=t.get(r),c=t.get(n),u="M"===o.gender?o.id:"M"===c.gender?c.id:o.id,h=o.id===u?c.id:o.id,x=u<h?"".concat(u,"|").concat(h):"".concat(h,"|").concat(u),p=Math.min(S(u),S(h)),f=A([u,h],e),v=i(u),g=i(h),m=null!=f?f:v&&v.includes("|")?v:g&&g.includes("|")?g:v||g||"single:".concat(u),b=m.startsWith("single:")||""===m?E([u,h]):d(m);(null==l?void 0:l.collapsedCouples)&&l.collapsedCouples.has(x)?s.push({ids:[u],rank:p,parentsKey:m,weight:b}):s.push({ids:[u,h],rank:p,parentsKey:m,weight:b})}else{let t=S(r),l=A([r],e),n=null!=l?l:i(r),a=n||"single:".concat(r),o=n?d(n):E([r]);s.push({ids:[r],rank:t,parentsKey:a,weight:o})}}let u=new Map;for(let e of s)u.has(e.parentsKey)||u.set(e.parentsKey,[]),u.get(e.parentsKey).push(e);let h=e=>{var l,r;let n=t.get(e);return"".concat(null!==(l=null==n?void 0:n.last_name)&&void 0!==l?l:""," ").concat(null!==(r=null==n?void 0:n.first_name)&&void 0!==r?r:"").toLowerCase()};for(let e of u.values())e.sort((e,t)=>{if(e.rank!==t.rank)return e.rank-t.rank;let l=e.ids[0],r=t.ids[0];return h(l).localeCompare(h(r))});let x=[];for(let[e,t]of u.entries()){let l;if(e&&!e.startsWith("single:")){let r=e.split("|").filter(Boolean).map(e=>{var t;return null===(t=C.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);l=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:t.reduce((e,t)=>e+t.weight,0)/t.length}else l=t.reduce((e,t)=>e+t.weight,0)/t.length;let r=t.map(e=>2===e.ids.length?120+j:j),n=r.reduce((e,t)=>e+t,0)+y*(t.length-1),a=l-n/2,s=[],i=a;for(let e=0;e<t.length;e++){let t=r[e],l=i+t/2;s.push(l),i+=t+y}x.push({key:e,blocks:t,anchor:l,left:a,right:a+n,offsets:s})}x.sort((e,t)=>e.anchor-t.anchor);let p=-1/0;for(let e of x){if(e.left<=p){let t=p-e.left+y;e.left+=t,e.right+=t,e.anchor+=t,e.offsets=e.offsets.map(e=>e+t)}p=e.right}for(let t of x)for(let l=0;l<t.blocks.length;l++){let n=t.blocks[l],a=t.offsets[l];if(2===n.ids.length){let[t,l]=n.ids,s=a-60,i=a+60;C.set(t,{id:t,x:s,y:r,depth:e}),C.set(l,{id:l,x:i,y:r,depth:e})}else{let t=n.ids[0];C.set(t,{id:t,x:a,y:r,depth:e})}}for(let l of x){let r=l.key;if(!r||r.startsWith("single:"))continue;let n=r.split("|").filter(Boolean).filter(t=>{var l;return(null!==(l=w.get(t))&&void 0!==l?l:0)===e-1});if(0===n.length)continue;let a=(l.left+l.right)/2;if(2===n.length){let[l,r]=n,s=t.get(l),i=t.get(r),d=a-60,o=a+60;(null==s?void 0:s.gender)==="M"||(null==s?void 0:s.gender)&&!(null==i?void 0:i.gender)?(C.set(l,{id:l,x:d,y:(e-1)*b,depth:e-1}),C.set(r,{id:r,x:o,y:(e-1)*b,depth:e-1})):(null==i?void 0:i.gender)==="M"?(C.set(r,{id:r,x:d,y:(e-1)*b,depth:e-1}),C.set(l,{id:l,x:o,y:(e-1)*b,depth:e-1})):(C.set(l,{id:l,x:d,y:(e-1)*b,depth:e-1}),C.set(r,{id:r,x:o,y:(e-1)*b,depth:e-1}))}else if(1===n.length){let t=n[0];C.set(t,{id:t,x:a,y:(e-1)*b,depth:e-1})}}}if(M.includes(0)){let e=null!==(u=k.get(0))&&void 0!==u?u:[],l=new Set,r=[];for(let n of e){if(l.has(n))continue;l.add(n);let e=(null!==(p=null===(h=t.get(n))||void 0===h?void 0:h.partners)&&void 0!==p?p:[]).find(e=>{var t;return(null!==(t=w.get(e))&&void 0!==t?t:0)===0}),a=(()=>{var l,r,a,s,i,d,o,c,u,h;let x=new Set;if(e){for(let r of null!==(a=null===(l=t.get(n))||void 0===l?void 0:l.children)&&void 0!==a?a:[]){let l=null!==(i=null===(s=t.get(r))||void 0===s?void 0:s.parents)&&void 0!==i?i:[];l.includes(n)&&l.includes(e)&&x.add(r)}for(let l of null!==(d=null===(r=t.get(e))||void 0===r?void 0:r.children)&&void 0!==d?d:[]){let r=null!==(c=null===(o=t.get(l))||void 0===o?void 0:o.parents)&&void 0!==c?c:[];r.includes(n)&&r.includes(e)&&x.add(l)}}else for(let e of null!==(h=null===(u=t.get(n))||void 0===u?void 0:u.children)&&void 0!==h?h:[])x.add(e);return Array.from(x).map(e=>{var t;return null===(t=C.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e)})(),s=a.length?a.reduce((e,t)=>e+t,0)/a.length:null!==(f=null===(x=C.get(n))||void 0===x?void 0:x.x)&&void 0!==f?f:0;if(e&&!l.has(e)){l.add(e);let t=120+j,a=s-t/2,i=s+t/2;r.push({ids:[n,e],anchor:s,left:a,right:i})}else{let e=s-j/2,t=s+j/2;r.push({ids:[n],anchor:s,left:e,right:t})}}r.sort((e,t)=>e.anchor-t.anchor);let n=-1/0;for(let e of r){let t=e.left,l=e.right;if(t<=n){let e=n-t+y;t+=e,l+=e}n=l;let r=(t+l)/2;if(2===e.ids.length){let[t,l]=e.ids,n=r-60,a=r+60;C.set(t,{id:t,x:n,y:0,depth:0}),C.set(l,{id:l,x:a,y:0,depth:0})}else{let t=e.ids[0];C.set(t,{id:t,x:r,y:0,depth:0})}}}for(let e of M){let l=null!==(v=k.get(e))&&void 0!==v?v:[],r=new Set,n=[];for(let a of l){if(r.has(a))continue;r.add(a);let l=C.get(a);if(!l)continue;let s=(null!==(m=null===(g=t.get(a))||void 0===g?void 0:g.partners)&&void 0!==m?m:[]).find(t=>{var l;return(null!==(l=w.get(t))&&void 0!==l?l:0)===e});if(s&&!r.has(s)){r.add(s);let e=C.get(s);if(!e)continue;let t=Math.min(l.x,e.x)-60,i=Math.max(l.x,e.x)+60;n.push({ids:[a,s],left:t,right:i,center:(t+i)/2})}else{let e=l.x-j/2,t=l.x+j/2;n.push({ids:[a],left:e,right:t,center:l.x})}}n.sort((e,t)=>e.left-t.left);let a=-1/0;for(let e of n){let t=0;if(e.left<=a&&(t=a-e.left+y),0!==t){if(e.left+=t,e.right+=t,e.center+=t,2===e.ids.length){let[t,l]=e.ids;C.get(t).x=e.center-60,C.get(l).x=e.center+60}else{let t=e.ids[0];C.get(t).x=e.center}}a=e.right}}let I=Array.from(C.values()).map(e=>e.x);if(I.length>0){let e=(Math.min(...I)+Math.max(...I))/2;for(let t of C.values())t.x-=e}return{nodes:Array.from(C.values()),positionById:C}})(0,S,{levelGap:180,nodeGap:220,cardWidth:140,blockMargin:40}),[[],S]),[D,I]=(0,n.useState)(.8),[L,z]=(0,n.useState)({x:300,y:160}),[P,F]=(0,n.useState)(!0),U=(0,n.useMemo)(()=>{let e=new Set(Array.from(v.values()).filter(e=>{var t;return(null!==(t=e.generation)&&void 0!==t?t:0)===1}).map(e=>e.id)),t=new Set;for(let l of x)e.has(l.partner_a)&&e.has(l.partner_b)&&t.add(k(l.partner_a,l.partner_b));let l=new Set;for(let e of v.values()){var r,n,a,s,i;if((null!==(a=e.generation)&&void 0!==a?a:0)!==1)continue;let t=(null!==(s=null===(r=e.partners)||void 0===r?void 0:r.length)&&void 0!==s?s:0)>0,d=(null!==(i=null===(n=e.children)||void 0===n?void 0:n.length)&&void 0!==i?i:0)>0;!t&&d&&l.add(e.id)}return{coupleKeys:t,singleIds:l}},[v,x]),q=(0,n.useRef)(!1);(0,n.useEffect)(()=>{if(q.current)return;let e=e=>(null!=e?e:"").toLowerCase().trim(),t=(t,l)=>{let r=e(t),n=e(l),a=Array.from(v.values()).find(t=>e(t.first_name||t.preferred_name)===r&&e(t.last_name)===n);return(null==a?void 0:a.id)||null},l=t("to dung","tran"),r=t("bao hue","chau"),{coupleKeys:n,singleIds:a}=U,s=l&&r?k(l,r):null,i=new Set;for(let e of n)s&&e===s||i.add(e);let d=new Set(a);j(i),w(d),q.current=!0},[v,x]);let G=()=>{let{coupleKeys:e,singleIds:t}=U;j(new Set(e)),w(new Set(t))},X=()=>{j(new Set),w(new Set)},B=(0,n.useMemo)(()=>b.size>0||y.size>0,[b.size,y.size]),R=(0,n.useMemo)(()=>"undefined"!=typeof navigator&&/iP(hone|ad|od)/i.test(navigator.userAgent),[]),T=(0,n.useRef)(null);(0,n.useEffect)(()=>{let e=T.current;if(!e)return;let t=e=>{(e.touches.length>=2||O.current)&&e.preventDefault()},l=e=>{e.touches.length>=2&&e.preventDefault()};return e.addEventListener("touchmove",t,{passive:!1}),e.addEventListener("touchstart",l,{passive:!1}),()=>{e.removeEventListener("touchmove",t),e.removeEventListener("touchstart",l)}},[]);let W=e=>{var t,l;let r=null!==(l=null===(t=S.get(e))||void 0===t?void 0:t.parents)&&void 0!==l?l:[];if(r.length<2)return!1;let[n,a]=r,s=k(n,a);return b.has(s)},O=(0,n.useRef)(!1),Y=(0,n.useRef)({x:0,y:0}),J=e=>{O.current=!0,Y.current={x:e.clientX,y:e.clientY}},K=(0,n.useRef)(new Map),Z=(0,n.useRef)(null),H=(0,n.useRef)(null),Q=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),V=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}),$=e=>{if("mouse"!==e.pointerType)try{var t,l;null===(t=(l=e.currentTarget).setPointerCapture)||void 0===t||t.call(l,e.pointerId)}catch(e){}if(K.current.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===K.current.size){let[e,t]=Array.from(K.current.values()),l=Q(e,t),r=V(e,t),n={...L},a={x:(r.x-n.x)/D,y:(r.y-n.y)/D};Z.current={dist:l,scale:D,translate:n,worldOrigin:a,screenOrigin:r}}1===K.current.size&&(O.current=!1,H.current={x:e.clientX,y:e.clientY})},ee=e=>{let t=K.current;if(t.has(e.pointerId)){if(t.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===t.size&&Z.current){let[e,l]=Array.from(t.values()),r=Q(e,l),n=V(e,l),a=Z.current,s=r/(a.dist||1),i=Math.min(2,Math.max(.3,a.scale*s)),d=a.worldOrigin,o={x:n.x-d.x*i,y:n.y-d.y*i};I(i),z(o)}else if(1===t.size){let l=t.get(e.pointerId);if(!O.current){let e=H.current;if(e){if(!(Math.hypot(l.x-e.x,l.y-e.y)>4))return;O.current=!0,Y.current={x:l.x,y:l.y}}}if(O.current){let e=l.x-Y.current.x,t=l.y-Y.current.y;z(l=>({x:l.x+e,y:l.y+t})),Y.current={x:l.x,y:l.y}}}}},et=e=>{K.current.delete(e),K.current.size<2&&(Z.current=null),0===K.current.size&&(O.current=!1,H.current=null)},el=e=>et(e.pointerId),er=e=>et(e.pointerId);(0,n.useMemo)(()=>{let e=g.trim().toLowerCase();return e?Array.from(S.values()).filter(t=>{var l,r,n;return"".concat(null!==(r=null!==(l=t.preferred_name)&&void 0!==l?l:t.first_name)&&void 0!==r?r:""," ").concat(null!==(n=t.last_name)&&void 0!==n?n:"").toLowerCase().includes(e)}):[]},[g,S]);let en=(e,t)=>{let l=A.get(e);if(!l)return;let r="number"==typeof t?Math.max(.3,Math.min(2,t)):D;I(r);let n={w:window.innerWidth,h:window.innerHeight};z({x:n.w/2-l.x*r,y:n.h/2-l.y*r})},ea=e=>{var t,l;let r=null!==(l=null===(t=v.get(e))||void 0===t?void 0:t.partners)&&void 0!==l?l:[];if(0===r.length){w(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l});return}j(t=>{let l=new Set(t),n=r.every(t=>l.has(k(e,t)));for(let t of r){let r=k(e,t);n?l.delete(r):l.add(r)}return l})},es=()=>{if(0===E.length)return;let e=E.map(e=>e.x),t=E.map(e=>e.y),l=Math.min(...e)-70,r=Math.max(...e)+70,n=Math.min(...t)-75,a=Math.max(...t)+75,s=window.innerWidth-(P?320:0),i=window.innerHeight-40,d=Math.min(2,Math.max(.3,.9*Math.min(s/(r-l),i/(a-n))));I(d),z({x:s/2+(P?320:0)/2-(l+r)/2*d,y:i/2-(n+a)/2*d})},[ei,ed]=(0,n.useState)(null),eo=ei&&null!==(t=S.get(ei))&&void 0!==t?t:null;(0,u.useRouter)();let ec=(0,n.useMemo)(()=>o(),[]),[eu,eh]=(0,n.useState)({}),[ex,ep]=(0,n.useState)(""),[ef,ev]=(0,n.useState)(""),[eg,em]=(0,n.useState)("");(0,n.useEffect)(()=>{var e,t,l,r,n,a,s,i,d,o,c,u,h,x,p,f,g;if(!eo)return;eh({first_name:null!==(l=eo.first_name)&&void 0!==l?l:"",last_name:null!==(r=eo.last_name)&&void 0!==r?r:"",preferred_name:null!==(n=eo.preferred_name)&&void 0!==n?n:"",gender:null!==(a=eo.gender)&&void 0!==a?a:null,birth_date:null!==(s=eo.birth_date)&&void 0!==s?s:"",birth_place:null!==(i=eo.birth_place)&&void 0!==i?i:"",death_date:null!==(d=eo.death_date)&&void 0!==d?d:"",death_place:null!==(o=eo.death_place)&&void 0!==o?o:"",status:null!==(c=eo.status)&&void 0!==c?c:null,phone:null!==(u=eo.phone)&&void 0!==u?u:"",facebook:null!==(h=eo.facebook)&&void 0!==h?h:"",photo:null!==(x=eo.photo)&&void 0!==x?x:"",generation:null!==(p=eo.generation)&&void 0!==p?p:null});let m=null!==(f=null===(e=v.get(eo.id))||void 0===e?void 0:e.parents)&&void 0!==f?f:[],b=m.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="M"})||m[0]||"",j=m.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="F"})||(m.length>1?m[1]:"")||"";ep(b||""),ev(j||""),em((null!==(g=null===(t=v.get(eo.id))||void 0===t?void 0:t.partners)&&void 0!==g?g:[])[0]||"")},[eo]);let eb=async()=>{if(!eo)return;let e={...eu};try{var t,l,r,n;await ec.from("people").update(e).eq("id",eo.id);let a=null!==(r=null===(t=v.get(eo.id))||void 0===t?void 0:t.parents)&&void 0!==r?r:[],s=a.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="M"})||a[0]||"",i=a.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="F"})||(a.length>1?a[1]:"")||"",d=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),o=eo.id;(ex||"")!==(s||"")&&(s&&await ec.from("parent_child").delete().eq("parent_id",s).eq("child_id",o),ex&&await ec.from("parent_child").insert({id:d(),parent_id:ex,child_id:o})),(ef||"")!==(i||"")&&(i&&await ec.from("parent_child").delete().eq("parent_id",i).eq("child_id",o),ef&&await ec.from("parent_child").insert({id:d(),parent_id:ef,child_id:o}));let c=(null!==(n=null===(l=v.get(eo.id))||void 0===l?void 0:l.partners)&&void 0!==n?n:[])[0]||"";(eg||"")!==(c||"")&&(c&&(await ec.from("marriages").delete().eq("partner_a",o).eq("partner_b",c),await ec.from("marriages").delete().eq("partner_a",c).eq("partner_b",o)),eg&&await ec.from("marriages").insert({id:d(),partner_a:o,partner_b:eg})),ed(null),f&&await f()}catch(e){console.error(e)}},[ej,ey]=(0,n.useState)(!1),ew={gender:"M",status:"Living",generation:2},[e_,eN]=(0,n.useState)(ew),[ek,eM]=(0,n.useState)(""),[eC,eS]=(0,n.useState)(""),[eE,eA]=(0,n.useState)(""),eD=(0,n.useMemo)(()=>Array.from(v.values()),[v]),eI=async()=>{if(!e_.first_name||!e_.last_name){alert("First and last name are required");return}if(!e_.status){alert("Status is required");return}if("number"!=typeof e_.generation||isNaN(e_.generation)){alert("Generation is required");return}if(!e_.gender){alert("Gender is required");return}try{let e="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),{data:t,error:l}=await ec.from("people").insert({id:e,...e_}).select().single();if(l)throw l;let r=(null==t?void 0:t.id)||e,n=[],a=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2));if(ek&&n.push({id:a(),parent_id:ek,child_id:r}),eC&&n.push({id:a(),parent_id:eC,child_id:r}),n.length){let{error:e}=await ec.from("parent_child").insert(n);if(e)throw e}if(eE){let{error:e}=await ec.from("marriages").insert({id:a(),partner_a:r,partner_b:eE});if(e)throw e}ey(!1),eM(""),eS(""),eA(""),eN(ew),f&&await f()}catch(e){console.error(e)}};return(0,n.useEffect)(()=>{if(!eo)return;let e=e=>{"Escape"===e.key&&ed(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eo]),(0,n.useEffect)(()=>{E.length>0&&es()},[E.length]),(0,n.useEffect)(()=>{window.innerWidth<1024&&F(!1)},[]),(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[P&&(0,r.jsxs)("aside",{className:"w-80 border-r border-slate-800 bg-slate-900/70 glass p-4 space-y-4 overflow-y-auto relative",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 bg-slate-900/90 pt-2 pb-3 space-y-2",children:[(0,r.jsxs)("div",{className:"px-1 text-lg font-semibold text-slate-100",children:["Family Tree ",(0,r.jsx)("span",{className:"text-pink-400",children:"❤"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(s.Z,{className:"h-5 w-5 text-slate-400"}),(0,r.jsx)("input",{className:"w-full rounded-md bg-slate-800/70 border border-slate-700 px-3 py-2 text-slate-100 placeholder:text-slate-400 focus:outline-none focus:ring",placeholder:"Search by name...",value:g,onChange:e=>m(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"sticky top-20 flex items-center gap-2 z-10 bg-slate-900/90 py-2",children:[(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>I(e=>Math.min(2,e+.1)),children:"+"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>I(e=>Math.max(.3,e-.1)),children:"-"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:es,children:"Reset"})]}),Array.from(new Set(h.map(e=>{var t;return null!==(t=e.generation)&&void 0!==t?t:0}))).sort((e,t)=>e-t).map(e=>{let t=h.filter(t=>{var l;return(null!==(l=t.generation)&&void 0!==l?l:0)===e}).sort((e,t)=>{var l,r,n,a,s,i,d,o,c,u;let h=(null!==(d=null===(l=S.get(e.id))||void 0===l?void 0:l.parents)&&void 0!==d?d:[]).slice().sort().join("|"),x=(null!==(o=null===(r=S.get(t.id))||void 0===r?void 0:r.parents)&&void 0!==o?o:[]).slice().sort().join("|"),p=(null!==(c=null===(a=S.get(e.id))||void 0===a?void 0:null===(n=a.parents)||void 0===n?void 0:n.length)&&void 0!==c?c:0)>0?0:1,f=(null!==(u=null===(i=S.get(t.id))||void 0===i?void 0:null===(s=i.parents)||void 0===s?void 0:s.length)&&void 0!==u?u:0)>0?0:1;return p!==f?p-f:h!==x?h.localeCompare(x):(null!=e.birth_date?parseInt(String(e.birth_date),10):Number.MAX_SAFE_INTEGER)-(null!=t.birth_date?parseInt(String(t.birth_date),10):Number.MAX_SAFE_INTEGER)}).map(e=>e.id);return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Generation ",e]})}),t.map(e=>{var t;let l=S.get(e);if(!l)return null;let n=(l.preferred_name||l.first_name||"")+" "+(l.last_name||"");return g&&!n.toLowerCase().includes(g.toLowerCase())?null:(0,r.jsxs)("button",{className:"w-full flex items-center gap-3 rounded px-2 py-2 hover:bg-slate-800/70",onClick:()=>{en(e,1.2),_&&ed(e)},children:[l.photo?(0,r.jsx)("img",{src:l.photo,alt:n,className:"h-9 w-9 rounded-full object-cover"}):(0,r.jsx)("div",{className:"h-9 w-9 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm text-slate-100",children:n}),(0,r.jsx)("div",{className:"text-[11px] text-slate-400",children:null!==(t=l.status)&&void 0!==t?t:"Unknown"})]})]},e)})]},e)}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-4",children:"Tip: drag to pan, scroll to zoom. Click a name to center."})]}),(0,r.jsxs)("main",{className:"flex-1 relative bg-gradient-to-b from-slate-900 to-slate-950",onPointerDown:$,onPointerMove:ee,onPointerUp:el,onPointerCancel:er,style:{touchAction:"none"},children:[(0,r.jsx)("button",{className:"absolute left-2 top-2 z-50 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40",onClick:()=>{F(e=>!e),setTimeout(es,50)},children:P?"Hide sidebar":"Show sidebar"}),(0,r.jsxs)("svg",{ref:T,className:"absolute inset-0 w-full h-full",onWheel:e=>{I(Math.min(2,Math.max(.3,D-.001*e.deltaY)))},onMouseDown:e=>{e.target.closest("[data-node]")||J(e)},onMouseMove:e=>{if(!O.current)return;let t=e.clientX-Y.current.x,l=e.clientY-Y.current.y;z(e=>({x:e.x+t,y:e.y+l})),Y.current={x:e.clientX,y:e.clientY}},onMouseUp:()=>{O.current=!1},onPointerDown:$,onPointerMove:ee,onPointerUp:el,onPointerCancel:er,style:{touchAction:R?"manipulation":"none"},children:[(0,r.jsxs)("defs",{children:[(0,r.jsx)("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:(0,r.jsx)("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#475569"})}),(0,r.jsx)("filter",{id:"coupleShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:(0,r.jsx)("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"#000",floodOpacity:"0.25"})})]}),(0,r.jsxs)("g",{transform:"translate(".concat(L.x,", ").concat(L.y,") scale(").concat(D,")"),children:[(()=>{let e=new Set;for(let t of C.mar){let l=t.partner_a<t.partner_b?t.partner_a:t.partner_b,r=t.partner_a<t.partner_b?t.partner_b:t.partner_a;e.add("".concat(l,"|").concat(r))}let t=new Map;for(let e of p)t.has(e.child_id)||t.set(e.child_id,new Set),t.get(e.child_id).add(e.parent_id);let l=[],n=new Set;for(let[r,a]of t){if(W(r)){n.add(r);continue}let t=Array.from(a);if(t.length>=2){let a=t[0],s=t[1],i=a<s?a:s,d=a<s?s:a;if(e.has("".concat(i,"|").concat(d))){let e=A.get(i),t=A.get(d),a=A.get(r);if(e&&t&&a){let s=(e.x+t.x)/2,o=Math.max(e.y,t.y)+75,c=a.x,u=a.y-75;l.push({key:"".concat(i,"-").concat(d,"-").concat(r),x1:s,y1:o,x2:c,y2:u}),n.add(r)}}}}for(let e of p){if(W(e.child_id)||n.has(e.child_id))continue;let t=A.get(e.parent_id),r=A.get(e.child_id);if(!t||!r)continue;let a=t.x,s=t.y+75,i=r.x,d=r.y-75;l.push({key:e.id,x1:a,y1:s,x2:i,y2:d})}return l.map(e=>(0,r.jsx)("path",{d:"M ".concat(e.x1," ").concat(e.y1," C ").concat(e.x1," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat(e.y2),stroke:"#475569",strokeWidth:"3",fill:"none",markerEnd:"url(#arrow)"},e.key))})(),C.mar.map(e=>{let t=A.get(e.partner_a),l=A.get(e.partner_b);if(!t||!l)return null;let n=t.y,a=Math.min(t.x-70,l.x-70),s=Math.max(t.x+70,l.x+70);return(0,r.jsx)("rect",{x:a-12,y:n-75-8,width:s-a+24,height:166,rx:20,ry:20,fill:"rgba(255,255,255,0.07)",stroke:"rgba(255,255,255,0.28)",strokeWidth:1,filter:"url(#coupleShadow)"},e.id)}),(()=>{let e=Array.from(new Set(E.map(e=>e.depth))).sort((e,t)=>e-t),t=Math.min(...E.map(e=>e.x))-200,l=Math.max(...E.map(e=>e.x))+200;return e.map(e=>{let n=180*e;return(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:t,y1:n,x2:l,y2:n,stroke:"#1f2937",strokeDasharray:"6 10",strokeWidth:2}),(0,r.jsx)("rect",{x:t,y:n-20,width:120,height:28,rx:8,fill:"#0f172a",stroke:"#1f2937"}),(0,r.jsxs)("text",{x:t+60,y:n-2,fill:"#e2e8f0",fontSize:12,textAnchor:"middle",children:["Generation ",e]})]},e)})})(),Array.from(new Map(E.map(e=>[e.id,e])).values()).filter(e=>!W(e.id)).map(e=>{var t,l,n,s;let i=S.get(e.id),d="M"===i.gender?"bg-male/90":"F"===i.gender?"bg-female/90":"bg-neutral/80",o=(i.status||"").toLowerCase(),c=e.x-70,u=e.y-75,h=v.get(i.id)||i,x=null!==(l=null==h?void 0:h.partners)&&void 0!==l?l:[],p=x.length>0||(null!==(n=null==h?void 0:null===(t=h.children)||void 0===t?void 0:t.length)&&void 0!==n?n:0)>0,f="none";if(p){if(x.length>0){let e=k(i.id,x[0]);f=b.has(e)?"collapsed":"expanded"}else f=y.has(i.id)?"collapsed":"expanded"}if(R){let t="M"===i.gender?"rgba(56,189,248,0.9)":"F"===i.gender?"rgba(244,114,182,0.9)":"rgba(148,163,184,0.8)",l=e.x-70,n=e.y-75,a="clip-".concat(e.id),s=i.status?String(i.status).toLowerCase():"unknown",d=Math.max(54,6*s.length+18);return(0,r.jsxs)("g",{"data-node":!0,onClick:()=>{_?ed(e.id):ea(e.id)},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:a,children:(0,r.jsx)("circle",{cx:e.x,cy:e.y-32,r:26})})}),(0,r.jsx)("rect",{x:l,y:n,rx:16,ry:16,width:140,height:150,fill:t,stroke:"rgba(255,255,255,0.15)"}),"none"!==f&&(0,r.jsx)("text",{x:l+140-10,y:n+14,textAnchor:"end",fontSize:16,fill:"#fff",children:"collapsed"===f?"+":"−"}),i.photo?(0,r.jsx)("image",{href:i.photo,x:e.x-26,y:e.y-58,width:52,height:52,clipPath:"url(#".concat(a,")"),preserveAspectRatio:"xMidYMid slice"}):(0,r.jsx)("text",{x:e.x,y:e.y-32,textAnchor:"middle",fontSize:24,children:"\uD83D\uDC64"}),(0,r.jsx)("text",{x:e.x,y:e.y-2,textAnchor:"middle",fontSize:11,fill:"#fff",fontWeight:600,children:(i.preferred_name||i.first_name)+" "+(i.last_name||"")}),(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{x:e.x-d/2,y:e.y+4,width:d,height:16,rx:8,fill:"#ffffff",opacity:.95}),(0,r.jsx)("circle",{cx:e.x-d/2+8,cy:e.y+12,r:3,fill:"deceased"===o?"#f87171":"living"===o?"#22c55e":"#cbd5e1"}),(0,r.jsx)("text",{x:e.x-d/2+14,y:e.y+14,textAnchor:"start",fontSize:9,fill:"#0f172a",children:s})]}),i.children.length>0&&(0,r.jsxs)("text",{x:e.x,y:e.y+26,textAnchor:"middle",fontSize:10,fill:"#fff",children:["\uD83D\uDC76 ",i.children.length]})]},e.id)}return(0,r.jsx)("foreignObject",{x:c,y:u,width:140,height:150,"data-node":!0,onPointerDown:e=>{e.stopPropagation()},onPointerMove:e=>{e.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},onPointerCancel:e=>{e.stopPropagation()},children:(0,r.jsxs)("div",{className:(0,a.W)("rounded-2xl shadow-card text-white flex flex-col items-center justify-center h-full px-3 py-2 cursor-pointer relative select-none",d),onClick:()=>{_?ed(e.id):ea(e.id)},style:{touchAction:R?"manipulation":"none"},children:["none"!==f&&(0,r.jsx)("div",{className:"absolute top-1.5 right-2 text-lg font-semibold text-white/90 select-none pointer-events-none",children:"collapsed"===f?"+":"−"}),(0,r.jsx)("div",{className:"relative mb-2",children:i.photo?(0,r.jsx)("img",{src:i.photo,alt:null!==(s=i.first_name)&&void 0!==s?s:"",className:"h-24 w-24 rounded-full object-cover ring-2 ring-white/20"}):(0,r.jsx)("div",{className:"h-24 w-24 rounded-full bg-black/20 grid place-items-center text-3xl",children:"\uD83D\uDC64"})}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold leading-4",children:[i.preferred_name||i.first_name," ",i.last_name]}),(()=>{let e=i.status?String(i.status).toLowerCase():"unknown";return(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 bg-white/95 text-slate-900 rounded-full px-2 py-0.5 text-[10px] mt-0.5",children:[(0,r.jsx)("span",{className:(0,a.W)("w-1.5 h-1.5 rounded-full","deceased"===o?"bg-red-400":"living"===o?"bg-green-500":"bg-slate-300")}),e]})})(),(0,r.jsx)("div",{className:"flex items-center justify-center gap-2 mt-1 text-white/90",children:i.children.length>0&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 text-[10px]",children:[(0,r.jsx)("span",{role:"img","aria-label":"children",children:"\uD83D\uDC76"})," ",i.children.length]})})]})]})},e.id)})]})]}),(0,r.jsxs)("div",{className:"fixed md:absolute left-2 top-2 z-50 flex flex-col gap-2",style:{paddingTop:"env(safe-area-inset-top)",paddingLeft:"env(safe-area-inset-left)"},children:[(0,r.jsx)("button",{className:"w-40 rounded bg-slate-800 hover:bg-slate-700 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{B?X():G()},children:B?"Expand all":"Collapse all"}),(0,r.jsx)("button",{className:"w-40 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{F(e=>!e),setTimeout(es,50)},children:P?"Hide sidebar":"Show sidebar"}),(0,r.jsx)("button",{className:"w-40 rounded bg-slate-800 hover:bg-slate-700 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>N(!_),children:_?"Exit edit mode":"Edit mode"}),(0,r.jsx)("button",{className:"w-40 rounded bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{eN(ew),eM(""),eS(""),eA(""),ey(!0)},children:"Add person"})]}),eo&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>ed(null),children:(0,r.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[800px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 p-5 border-b border-slate-800",children:[eo.photo?(0,r.jsx)("img",{src:eo.photo,alt:"",className:"h-20 w-20 rounded-full object-cover ring-2 ring-white/10"}):(0,r.jsx)("div",{className:"h-20 w-20 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"text-xl font-semibold",children:[eo.preferred_name||eo.first_name," ",eo.last_name]}),(0,r.jsx)("div",{className:"text-sm text-slate-400 capitalize",children:(eo.status||"").toString()})]}),(0,r.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ed(null),children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"First name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.first_name||"",onChange:e=>eh(t=>({...t,first_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Last name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.last_name||"",onChange:e=>eh(t=>({...t,last_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.preferred_name||"",onChange:e=>eh(t=>({...t,preferred_name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Gender"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.gender||"",onChange:e=>eh(t=>({...t,gender:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"M",children:"M"}),(0,r.jsx)("option",{value:"F",children:"F"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Status",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:eu.status||"",onChange:e=>eh(t=>({...t,status:e.target.value})),children:[(0,r.jsx)("option",{value:"Living",children:"Living"}),(0,r.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.birth_date||"",onChange:e=>eh(t=>({...t,birth_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.birth_place||"",onChange:e=>eh(t=>({...t,birth_place:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Death date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.death_date||"",onChange:e=>eh(t=>({...t,death_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Death place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.death_place||"",onChange:e=>eh(t=>({...t,death_place:e.target.value}))})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Generation",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:String(null!==(l=eu.generation)&&void 0!==l?l:""),onChange:e=>eh(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null})),children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ex,onChange:e=>ep(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ef,onChange:e=>ev(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eg,onChange:e=>em(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Phone"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.phone||"",onChange:e=>eh(t=>({...t,phone:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Facebook"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.facebook||"",onChange:e=>eh(t=>({...t,facebook:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eu.photo||"",onChange:e=>eh(t=>({...t,photo:e.target.value}))})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:eb,children:"Save"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ed(null),children:"Cancel"})]})]})]}),(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Family"}),(0,r.jsx)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:(0,r.jsx)("svg",{width:"100%",height:"240",viewBox:"0 0 640 240",children:(()=>{var e,t,l;let n=(null!==(e=eo.parents)&&void 0!==e?e:[]).map(e=>S.get(e)).filter(Boolean),a=(null!==(t=eo.partners)&&void 0!==t?t:[]).map(e=>S.get(e)).filter(Boolean),s=(null!==(l=eo.children)&&void 0!==l?l:[]).map(e=>S.get(e)).filter(Boolean),i=n.map((e,t)=>160+t*(n.length>1?320:0)),d=a.map((e,t)=>320+(t+1)*140),o=s.length>1?s.map((e,t)=>100+440/(s.length-1)*t):[320],c=[];return n.forEach((e,t)=>{c.push((0,r.jsxs)("text",{x:i[t],y:30,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"pt-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(i[t]," ").concat(36," L ").concat(320," ").concat(106),stroke:"#64748b"},"p-line-".concat(e.id)))}),c.push((0,r.jsx)("circle",{cx:320,cy:120,r:12,fill:"#38bdf8"},"me")),c.push((0,r.jsxs)("text",{x:320,y:148,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[eo.preferred_name||eo.first_name," ",eo.last_name||""]},"me-t")),a.forEach((e,t)=>{c.push((0,r.jsx)("circle",{cx:d[t],cy:120,r:10,fill:"#f472b6"},"sp-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(332," ").concat(120," L ").concat(d[t]-12," ").concat(120),stroke:"#fb7185",strokeDasharray:"6 4"},"m-".concat(e.id)))}),s.forEach((e,t)=>{c.push((0,r.jsxs)("text",{x:o[t],y:210,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"ch-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(320," ").concat(134," L ").concat(o[t]," ").concat(196),stroke:"#64748b"},"c-line-".concat(e.id)))}),c})()})})]})]})}),ej&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>ey(!1),children:(0,r.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[820px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-slate-800",children:[(0,r.jsx)("div",{className:"text-lg font-semibold",children:"Add new person"}),(0,r.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ey(!1),children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["First name",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.first_name||"",onChange:e=>eN(t=>({...t,first_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Last name",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.last_name||"",onChange:e=>eN(t=>({...t,last_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.preferred_name||"",onChange:e=>eN(t=>({...t,preferred_name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Gender",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.gender||"",onChange:e=>eN(t=>({...t,gender:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"M",children:"M"}),(0,r.jsx)("option",{value:"F",children:"F"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Status",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:e_.status||"",onChange:e=>eN(t=>({...t,status:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"Living",children:"Living"}),(0,r.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.birth_date||"",onChange:e=>eN(t=>({...t,birth_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.birth_place||"",onChange:e=>eN(t=>({...t,birth_place:e.target.value}))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:e_.photo||"",onChange:e=>eN(t=>({...t,photo:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Generation",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:String(null!==(d=e_.generation)&&void 0!==d?d:""),onChange:e=>eN(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null})),children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ek,onChange:e=>eM(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eC,onChange:e=>eS(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eE,onChange:e=>eA(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eD.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:eI,children:"Create"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ey(!1),children:"Cancel"})]})]})]})]})})]})]})}var x=l(257);function p(){let[e,t]=(0,n.useState)(null),[l,a]=(0,n.useState)(null),[s,i]=(0,n.useState)(null),d=async()=>{var e,l,r;if("true"===x.env.NEXT_PUBLIC_USE_JSON_FALLBACK||"true"===x.env.USE_JSON_FALLBACK)try{let e=await fetch("/data/sample.json",{cache:"no-store"});if(e.ok){let l=await e.json();t(l.people||[]),a(l.marriages||[]),i(l.parent_child||[]);return}}catch(e){}let n=o(),[s,d,c]=await Promise.all([n.from("people").select("*").returns(),n.from("marriages").select("*").returns(),n.from("parent_child").select("*").returns()]);t(null!==(e=s.data)&&void 0!==e?e:[]),a(null!==(l=d.data)&&void 0!==l?l:[]),i(null!==(r=c.data)&&void 0!==r?r:[])};return((0,n.useEffect)(()=>{d()},[]),e&&l&&s)?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(h,{people:e,marriages:l,parentChild:s,onChanged:d}),(0,r.jsx)("div",{id:"modal-root",className:"fixed inset-0 pointer-events-none"})]}):(0,r.jsx)("div",{className:"min-h-screen grid place-items-center text-slate-300",children:"Loading…"})}},3538:function(e,t,l){"use strict";l.d(t,{EditModeProvider:function(){return s},S:function(){return i}});var r=l(7437),n=l(2265);let a=(0,n.createContext)(void 0);function s(e){let{children:t}=e,[l,s]=(0,n.useState)(!1);return(0,r.jsx)(a.Provider,{value:{editMode:l,setEditMode:s},children:t})}function i(){let e=(0,n.useContext)(a);if(!e)throw Error("useEditMode must be used within EditModeProvider");return e}}},function(e){e.O(0,[156,971,117,744],function(){return e(e.s=1169)}),_N_E=e.O()}]);