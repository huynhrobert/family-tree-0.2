(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{5282:function(e){function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=function(){return[]},t.resolve=t,t.id=5282,e.exports=t},1169:function(e,t,l){Promise.resolve().then(l.bind(l,7701))},7701:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return p}});var r=l(7437),a=l(2265),n=l(1994),s=l(8193);function i(e,t,l){var r,a,n;let s=new Map(e.map(e=>[e.id,e])),i=new Map;for(let t of e)i.set(t.id,{...t,children:[],partners:[]});for(let e of t)null===(r=i.get(e.partner_a))||void 0===r||r.partners.push(e.partner_b),null===(a=i.get(e.partner_b))||void 0===a||a.partners.push(e.partner_a);for(let e of l){null===(n=i.get(e.parent_id))||void 0===n||n.children.push(e.child_id);let t=i.get(e.child_id);t&&(t.parents||(t.parents=[]),t.parents.push(e.parent_id))}return{nodeById:i,personById:s}}var d=l(1388);let o=()=>(0,d.createBrowserClient)("https://knqbdesytcdyzuxclnoy.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtucWJkZXN5dGNkeXp1eGNsbm95Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQxMTkxNjEsImV4cCI6MjA2OTY5NTE2MX0.z9dGc6cn3MXAUagOY8bJm9-XKgqgiZS8bk81dz70uf8");var c=l(3538),u=l(9376);function h(e){var t,l,d;let{people:h,marriages:x,parentChild:p,onChanged:f}=e,{nodeById:v}=(0,a.useMemo)(()=>i(h,x,p),[h,x,p]),[g,m]=(0,a.useState)(""),[b,j]=(0,a.useState)(new Set),[y,w]=(0,a.useState)(new Set),{editMode:_,setEditMode:N}=(0,c.S)(),k=(e,t)=>e<t?"".concat(e,"|").concat(t):"".concat(t,"|").concat(e),C=(0,a.useMemo)(()=>{var e,t,l,r,a,n,s,i,d,o;let c=new Set,u=e=>{let t=[e];for(;t.length;){var l,r,a,n;let e=t.pop();if(!c.has(e)){for(let r of(c.add(e),null!==(a=null===(l=v.get(e))||void 0===l?void 0:l.children)&&void 0!==a?a:[]))t.push(r);for(let l of null!==(n=null===(r=v.get(e))||void 0===r?void 0:r.partners)&&void 0!==n?n:[])t.push(l)}}};for(let s of b){let[i,d]=s.split("|");for(let s of new Set([...null!==(l=null===(e=v.get(i))||void 0===e?void 0:e.children)&&void 0!==l?l:[],...null!==(r=null===(t=v.get(d))||void 0===t?void 0:t.children)&&void 0!==r?r:[]]))for(let e of(u(s),null!==(n=null===(a=v.get(s))||void 0===a?void 0:a.partners)&&void 0!==n?n:[]))u(e)}for(let e of y)for(let t of null!==(i=null===(s=v.get(e))||void 0===s?void 0:s.children)&&void 0!==i?i:[])for(let e of(u(t),null!==(o=null===(d=v.get(t))||void 0===d?void 0:d.partners)&&void 0!==o?o:[]))u(e);return c},[b,y,v]),M=(0,a.useMemo)(()=>{let e=new Set(h.filter(e=>!C.has(e.id)).map(e=>e.id));return{ppl:h.filter(t=>e.has(t.id)),mar:x.filter(t=>e.has(t.partner_a)&&e.has(t.partner_b)),pc:p.filter(t=>e.has(t.parent_id)&&e.has(t.child_id))}},[h,x,p,C]),{nodeById:S}=(0,a.useMemo)(()=>i(M.ppl,M.mar,M.pc),[M]),{nodes:E,positionById:A}=(0,a.useMemo)(()=>(function(e,t,l){var r,a,n,s,i,d,o,c,u,h,x,p,f,v,g,m;let b=null!==(r=null==l?void 0:l.levelGap)&&void 0!==r?r:220;null==l||l.nodeGap;let j=null!==(a=null==l?void 0:l.cardWidth)&&void 0!==a?a:140,y=null!==(n=null==l?void 0:l.blockMargin)&&void 0!==n?n:30,w=new Map;for(let[e,l]of t)w.set(e,(null!==(s=l.generation)&&void 0!==s?s:0)|0);let _=new Map;for(let e of t.values())for(let t of e.partners)_.has(e.id)||_.set(e.id,[]),_.has(t)||_.set(t,[]),_.get(e.id).push(t),_.get(t).push(e.id);let N=new Set;for(let e of t.keys()){if(N.has(e))continue;let t=[e];N.add(e);let l=[];for(;t.length;){let e=t.pop();for(let r of(l.push(e),null!==(i=_.get(e))&&void 0!==i?i:[]))N.has(r)||(N.add(r),t.push(r))}let r=Math.min(...l.map(e=>{var t;return null!==(t=w.get(e))&&void 0!==t?t:0}));for(let e of l)w.set(e,r)}let k=new Map;for(let[e]of t){let t=null!==(d=w.get(e))&&void 0!==d?d:0;k.has(t)||k.set(t,[]),k.get(t).push(e)}let C=Array.from(k.keys()).sort((e,t)=>e-t),M=new Map,S=e=>{var l,r;let a=null!==(r=null===(l=t.get(e))||void 0===l?void 0:l.birth_date)&&void 0!==r?r:null;if(null===a)return Number.MAX_SAFE_INTEGER;let n=String(a).match(/\d{1,4}/),s=n?parseInt(n[0],10):Number.MAX_SAFE_INTEGER;return Number.isFinite(s)?s:Number.MAX_SAFE_INTEGER},E=e=>{var l,r;let a=new Set;for(let n of e)(null!==(r=null===(l=t.get(n))||void 0===l?void 0:l.parents)&&void 0!==r?r:[]).forEach(e=>a.add(e));let n=Array.from(a).map(e=>{var t;return null===(t=M.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);return 0===n.length?0:n.reduce((e,t)=>e+t,0)/n.length},A=(e,l)=>{let r=new Set;for(let i of e){var a,n,s;for(let e of null!==(n=null===(a=t.get(i))||void 0===a?void 0:a.parents)&&void 0!==n?n:[])(null!==(s=w.get(e))&&void 0!==s?s:0)===l-1&&r.add(e)}return 0===r.size?null:Array.from(r).sort().join("|")},D=e=>{if(!e)return 0;let t=e.split("|").filter(Boolean).map(e=>{var t;return null===(t=M.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);return 0===t.length?0:t.reduce((e,t)=>e+t,0)/t.length};for(let e of C){let r=e*b,a=k.get(e),n=new Set,s=[],i=e=>{var l,r;let a=(null!==(r=null===(l=t.get(e))||void 0===l?void 0:l.parents)&&void 0!==r?r:[]).slice().sort();return a.length>0?a.join("|"):""},d=e=>D(e);for(let r of a){if(n.has(r))continue;n.add(r);let a=(null!==(c=null===(o=t.get(r))||void 0===o?void 0:o.partners)&&void 0!==c?c:[]).find(t=>{var l;return(null!==(l=w.get(t))&&void 0!==l?l:0)===e});if(a&&!n.has(a)){n.add(a);let o=t.get(r),c=t.get(a),u="M"===o.gender?o.id:"M"===c.gender?c.id:o.id,h=o.id===u?c.id:o.id,x=u<h?"".concat(u,"|").concat(h):"".concat(h,"|").concat(u),p=Math.min(S(u),S(h)),f=A([u,h],e),v=i(u),g=i(h),m=null!=f?f:v&&v.includes("|")?v:g&&g.includes("|")?g:v||g||"single:".concat(u),b=m.startsWith("single:")||""===m?E([u,h]):d(m);(null==l?void 0:l.collapsedCouples)&&l.collapsedCouples.has(x)?s.push({ids:[u],rank:p,parentsKey:m,weight:b}):s.push({ids:[u,h],rank:p,parentsKey:m,weight:b})}else{let t=S(r),l=A([r],e),a=null!=l?l:i(r),n=a||"single:".concat(r),o=a?d(a):E([r]);s.push({ids:[r],rank:t,parentsKey:n,weight:o})}}let u=new Map;for(let e of s)u.has(e.parentsKey)||u.set(e.parentsKey,[]),u.get(e.parentsKey).push(e);let h=e=>{var l,r;let a=t.get(e);return"".concat(null!==(l=null==a?void 0:a.last_name)&&void 0!==l?l:""," ").concat(null!==(r=null==a?void 0:a.first_name)&&void 0!==r?r:"").toLowerCase()};for(let e of u.values())e.sort((e,t)=>{if(e.rank!==t.rank)return e.rank-t.rank;let l=e.ids[0],r=t.ids[0];return h(l).localeCompare(h(r))});let x=[];for(let[e,t]of u.entries()){let l;if(e&&!e.startsWith("single:")){let r=e.split("|").filter(Boolean).map(e=>{var t;return null===(t=M.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e);l=r.length>0?r.reduce((e,t)=>e+t,0)/r.length:t.reduce((e,t)=>e+t.weight,0)/t.length}else l=t.reduce((e,t)=>e+t.weight,0)/t.length;let r=t.map(e=>2===e.ids.length?60+j:j),a=r.reduce((e,t)=>e+t,0)+y*(t.length-1),n=l-a/2,s=[],i=n;for(let e=0;e<t.length;e++){let t=r[e],l=i+t/2;s.push(l),i+=t+y}x.push({key:e,blocks:t,anchor:l,left:n,right:n+a,offsets:s})}x.sort((e,t)=>e.anchor-t.anchor);let p=-1/0;for(let e of x){if(e.left<=p){let t=p-e.left+y;e.left+=t,e.right+=t,e.anchor+=t,e.offsets=e.offsets.map(e=>e+t)}p=e.right}for(let t of x)for(let l=0;l<t.blocks.length;l++){let a=t.blocks[l],n=t.offsets[l];if(2===a.ids.length){let[t,l]=a.ids,s=n-30,i=n+30;M.set(t,{id:t,x:s,y:r,depth:e}),M.set(l,{id:l,x:i,y:r,depth:e})}else{let t=a.ids[0];M.set(t,{id:t,x:n,y:r,depth:e})}}for(let l of x){let r=l.key;if(!r||r.startsWith("single:"))continue;let a=r.split("|").filter(Boolean).filter(t=>{var l;return(null!==(l=w.get(t))&&void 0!==l?l:0)===e-1});if(0===a.length)continue;let n=(l.left+l.right)/2;if(2===a.length){let[l,r]=a,s=t.get(l),i=t.get(r),d=n-30,o=n+30;(null==s?void 0:s.gender)==="M"||(null==s?void 0:s.gender)&&!(null==i?void 0:i.gender)?(M.set(l,{id:l,x:d,y:(e-1)*b,depth:e-1}),M.set(r,{id:r,x:o,y:(e-1)*b,depth:e-1})):(null==i?void 0:i.gender)==="M"?(M.set(r,{id:r,x:d,y:(e-1)*b,depth:e-1}),M.set(l,{id:l,x:o,y:(e-1)*b,depth:e-1})):(M.set(l,{id:l,x:d,y:(e-1)*b,depth:e-1}),M.set(r,{id:r,x:o,y:(e-1)*b,depth:e-1}))}else if(1===a.length){let t=a[0];M.set(t,{id:t,x:n,y:(e-1)*b,depth:e-1})}}}if(C.includes(0)){let e=null!==(u=k.get(0))&&void 0!==u?u:[],l=new Set,r=[];for(let a of e){if(l.has(a))continue;l.add(a);let e=(null!==(p=null===(h=t.get(a))||void 0===h?void 0:h.partners)&&void 0!==p?p:[]).find(e=>{var t;return(null!==(t=w.get(e))&&void 0!==t?t:0)===0}),n=(()=>{var l,r,n,s,i,d,o,c,u,h;let x=new Set;if(e){for(let r of null!==(n=null===(l=t.get(a))||void 0===l?void 0:l.children)&&void 0!==n?n:[]){let l=null!==(i=null===(s=t.get(r))||void 0===s?void 0:s.parents)&&void 0!==i?i:[];l.includes(a)&&l.includes(e)&&x.add(r)}for(let l of null!==(d=null===(r=t.get(e))||void 0===r?void 0:r.children)&&void 0!==d?d:[]){let r=null!==(c=null===(o=t.get(l))||void 0===o?void 0:o.parents)&&void 0!==c?c:[];r.includes(a)&&r.includes(e)&&x.add(l)}}else for(let e of null!==(h=null===(u=t.get(a))||void 0===u?void 0:u.children)&&void 0!==h?h:[])x.add(e);return Array.from(x).map(e=>{var t;return null===(t=M.get(e))||void 0===t?void 0:t.x}).filter(e=>"number"==typeof e)})(),s=n.length?n.reduce((e,t)=>e+t,0)/n.length:null!==(f=null===(x=M.get(a))||void 0===x?void 0:x.x)&&void 0!==f?f:0;if(e&&!l.has(e)){l.add(e);let t=60+j,n=s-t/2,i=s+t/2;r.push({ids:[a,e],anchor:s,left:n,right:i})}else{let e=s-j/2,t=s+j/2;r.push({ids:[a],anchor:s,left:e,right:t})}}r.sort((e,t)=>e.anchor-t.anchor);let a=-1/0;for(let e of r){let t=e.left,l=e.right;if(t<=a){let e=a-t+y;t+=e,l+=e}a=l;let r=(t+l)/2;if(2===e.ids.length){let[t,l]=e.ids,a=r-30,n=r+30;M.set(t,{id:t,x:a,y:0,depth:0}),M.set(l,{id:l,x:n,y:0,depth:0})}else{let t=e.ids[0];M.set(t,{id:t,x:r,y:0,depth:0})}}}for(let e of C){let l=null!==(v=k.get(e))&&void 0!==v?v:[],r=new Set,a=[];for(let n of l){if(r.has(n))continue;r.add(n);let l=M.get(n);if(!l)continue;let s=(null!==(m=null===(g=t.get(n))||void 0===g?void 0:g.partners)&&void 0!==m?m:[]).find(t=>{var l;return(null!==(l=w.get(t))&&void 0!==l?l:0)===e});if(s&&!r.has(s)){r.add(s);let e=M.get(s);if(!e)continue;let t=Math.min(l.x,e.x)-30,i=Math.max(l.x,e.x)+30;a.push({ids:[n,s],left:t,right:i,center:(t+i)/2})}else{let e=l.x-j/2,t=l.x+j/2;a.push({ids:[n],left:e,right:t,center:l.x})}}a.sort((e,t)=>e.left-t.left);let n=-1/0;for(let e of a){let t=0;if(e.left<=n&&(t=n-e.left+y),0!==t){if(e.left+=t,e.right+=t,e.center+=t,2===e.ids.length){let[t,l]=e.ids;M.get(t).x=e.center-30,M.get(l).x=e.center+30}else{let t=e.ids[0];M.get(t).x=e.center}}n=e.right}}let I=Array.from(M.values()).map(e=>e.x);if(I.length>0){let e=(Math.min(...I)+Math.max(...I))/2;for(let t of M.values())t.x-=e}return{nodes:Array.from(M.values()),positionById:M}})(0,S,{levelGap:180,nodeGap:220,cardWidth:140,blockMargin:40}),[[],S]),[D,I]=(0,a.useState)(.8),[L,z]=(0,a.useState)({x:300,y:160}),[P,F]=(0,a.useState)(!0),U=(0,a.useMemo)(()=>{let e=new Set(Array.from(v.values()).filter(e=>{var t;return(null!==(t=e.generation)&&void 0!==t?t:0)===1}).map(e=>e.id)),t=new Set;for(let l of x)e.has(l.partner_a)&&e.has(l.partner_b)&&t.add(k(l.partner_a,l.partner_b));let l=new Set;for(let e of v.values()){var r,a,n,s,i;if((null!==(n=e.generation)&&void 0!==n?n:0)!==1)continue;let t=(null!==(s=null===(r=e.partners)||void 0===r?void 0:r.length)&&void 0!==s?s:0)>0,d=(null!==(i=null===(a=e.children)||void 0===a?void 0:a.length)&&void 0!==i?i:0)>0;!t&&d&&l.add(e.id)}return{coupleKeys:t,singleIds:l}},[v,x]),q=(0,a.useRef)(!1);(0,a.useEffect)(()=>{if(q.current)return;let e=e=>(null!=e?e:"").toLowerCase().trim(),t=(t,l)=>{let r=e(t),a=e(l),n=Array.from(v.values()).find(t=>e(t.first_name||t.preferred_name)===r&&e(t.last_name)===a);return(null==n?void 0:n.id)||null},l=t("to dung","tran"),r=t("bao hue","chau"),{coupleKeys:a,singleIds:n}=U,s=l&&r?k(l,r):null,i=new Set;for(let e of a)s&&e===s||i.add(e);let d=new Set(n);j(i),w(d),q.current=!0},[v,x]);let G=()=>{let{coupleKeys:e,singleIds:t}=U;j(new Set(e)),w(new Set(t))},X=()=>{j(new Set),w(new Set)},R=(0,a.useMemo)(()=>b.size>0||y.size>0,[b.size,y.size]),B=(0,a.useMemo)(()=>"undefined"!=typeof navigator&&/iP(hone|ad|od)/i.test(navigator.userAgent),[]),T=(0,a.useRef)(null);(0,a.useEffect)(()=>{let e=T.current;if(!e)return;let t=e=>{(e.touches.length>=2||W.current)&&e.preventDefault()},l=e=>{e.touches.length>=2&&e.preventDefault()};return e.addEventListener("touchmove",t,{passive:!1}),e.addEventListener("touchstart",l,{passive:!1}),()=>{e.removeEventListener("touchmove",t),e.removeEventListener("touchstart",l)}},[]);let O=e=>{var t,l;let r=null!==(l=null===(t=S.get(e))||void 0===t?void 0:t.parents)&&void 0!==l?l:[];if(r.length<2)return!1;let[a,n]=r,s=k(a,n);return b.has(s)},W=(0,a.useRef)(!1),Y=(0,a.useRef)({x:0,y:0}),J=e=>{W.current=!0,Y.current={x:e.clientX,y:e.clientY}},K=(0,a.useRef)(new Map),Z=(0,a.useRef)(null),H=(0,a.useRef)(null),Q=(e,t)=>Math.hypot(e.x-t.x,e.y-t.y),V=(e,t)=>({x:(e.x+t.x)/2,y:(e.y+t.y)/2}),$=e=>{if("mouse"!==e.pointerType)try{var t,l;null===(t=(l=e.currentTarget).setPointerCapture)||void 0===t||t.call(l,e.pointerId)}catch(e){}if(K.current.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===K.current.size){let[e,t]=Array.from(K.current.values()),l=Q(e,t),r=V(e,t),a={...L},n={x:(r.x-a.x)/D,y:(r.y-a.y)/D};Z.current={dist:l,scale:D,translate:a,worldOrigin:n,screenOrigin:r}}1===K.current.size&&(W.current=!1,H.current={x:e.clientX,y:e.clientY})},ee=e=>{let t=K.current;if(t.has(e.pointerId)){if(t.set(e.pointerId,{id:e.pointerId,x:e.clientX,y:e.clientY}),2===t.size&&Z.current){let[e,l]=Array.from(t.values()),r=Q(e,l),a=V(e,l),n=Z.current,s=r/(n.dist||1),i=Math.min(2,Math.max(.3,n.scale*s)),d=n.worldOrigin,o={x:a.x-d.x*i,y:a.y-d.y*i};I(i),z(o)}else if(1===t.size){let l=t.get(e.pointerId);if(!W.current){let e=H.current;if(e){if(!(Math.hypot(l.x-e.x,l.y-e.y)>4))return;W.current=!0,Y.current={x:l.x,y:l.y}}}if(W.current){let e=l.x-Y.current.x,t=l.y-Y.current.y;z(l=>({x:l.x+e,y:l.y+t})),Y.current={x:l.x,y:l.y}}}}},et=e=>{K.current.delete(e),K.current.size<2&&(Z.current=null),0===K.current.size&&(W.current=!1,H.current=null)},el=e=>et(e.pointerId),er=e=>et(e.pointerId);(0,a.useMemo)(()=>{let e=g.trim().toLowerCase();return e?Array.from(S.values()).filter(t=>{var l,r,a;return"".concat(null!==(r=null!==(l=t.preferred_name)&&void 0!==l?l:t.first_name)&&void 0!==r?r:""," ").concat(null!==(a=t.last_name)&&void 0!==a?a:"").toLowerCase().includes(e)}):[]},[g,S]);let ea=e=>{var t,l;let r=null!==(l=null===(t=v.get(e))||void 0===t?void 0:t.partners)&&void 0!==l?l:[];if(0===r.length){w(t=>{let l=new Set(t);return l.has(e)?l.delete(e):l.add(e),l});return}j(t=>{let l=new Set(t),a=r.every(t=>l.has(k(e,t)));for(let t of r){let r=k(e,t);a?l.delete(r):l.add(r)}return l})},en=()=>{if(0===E.length)return;let e=E.map(e=>e.x),t=E.map(e=>e.y),l=Math.min(...e)-70,r=Math.max(...e)+70,a=Math.min(...t)-75,n=Math.max(...t)+75,s=window.innerWidth-(P?320:0),i=window.innerHeight-40,d=Math.min(2,Math.max(.3,.9*Math.min(s/(r-l),i/(n-a))));I(d),z({x:s/2+(P?320:0)/2-(l+r)/2*d,y:i/2-(a+n)/2*d})},[es,ei]=(0,a.useState)(null),ed=es&&null!==(t=S.get(es))&&void 0!==t?t:null;(0,u.useRouter)();let eo=(0,a.useMemo)(()=>o(),[]),[ec,eu]=(0,a.useState)({}),[eh,ex]=(0,a.useState)(""),[ep,ef]=(0,a.useState)(""),[ev,eg]=(0,a.useState)("");(0,a.useEffect)(()=>{var e,t,l,r,a,n,s,i,d,o,c,u,h,x,p,f,g;if(!ed)return;eu({first_name:null!==(l=ed.first_name)&&void 0!==l?l:"",last_name:null!==(r=ed.last_name)&&void 0!==r?r:"",preferred_name:null!==(a=ed.preferred_name)&&void 0!==a?a:"",gender:null!==(n=ed.gender)&&void 0!==n?n:null,birth_date:null!==(s=ed.birth_date)&&void 0!==s?s:"",birth_place:null!==(i=ed.birth_place)&&void 0!==i?i:"",death_date:null!==(d=ed.death_date)&&void 0!==d?d:"",death_place:null!==(o=ed.death_place)&&void 0!==o?o:"",status:null!==(c=ed.status)&&void 0!==c?c:null,phone:null!==(u=ed.phone)&&void 0!==u?u:"",facebook:null!==(h=ed.facebook)&&void 0!==h?h:"",photo:null!==(x=ed.photo)&&void 0!==x?x:"",generation:null!==(p=ed.generation)&&void 0!==p?p:null});let m=null!==(f=null===(e=v.get(ed.id))||void 0===e?void 0:e.parents)&&void 0!==f?f:[],b=m.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="M"})||m[0]||"",j=m.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="F"})||(m.length>1?m[1]:"")||"";ex(b||""),ef(j||""),eg((null!==(g=null===(t=v.get(ed.id))||void 0===t?void 0:t.partners)&&void 0!==g?g:[])[0]||"")},[ed]);let em=async()=>{if(!ed)return;let e={...ec};try{var t,l,r,a;await eo.from("people").update(e).eq("id",ed.id);let n=null!==(r=null===(t=v.get(ed.id))||void 0===t?void 0:t.parents)&&void 0!==r?r:[],s=n.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="M"})||n[0]||"",i=n.find(e=>{var t;return(null===(t=v.get(e))||void 0===t?void 0:t.gender)==="F"})||(n.length>1?n[1]:"")||"",d=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),o=ed.id;(eh||"")!==(s||"")&&(s&&await eo.from("parent_child").delete().eq("parent_id",s).eq("child_id",o),eh&&await eo.from("parent_child").insert({id:d(),parent_id:eh,child_id:o})),(ep||"")!==(i||"")&&(i&&await eo.from("parent_child").delete().eq("parent_id",i).eq("child_id",o),ep&&await eo.from("parent_child").insert({id:d(),parent_id:ep,child_id:o}));let c=(null!==(a=null===(l=v.get(ed.id))||void 0===l?void 0:l.partners)&&void 0!==a?a:[])[0]||"";(ev||"")!==(c||"")&&(c&&(await eo.from("marriages").delete().eq("partner_a",o).eq("partner_b",c),await eo.from("marriages").delete().eq("partner_a",c).eq("partner_b",o)),ev&&await eo.from("marriages").insert({id:d(),partner_a:o,partner_b:ev})),ei(null),f&&await f()}catch(e){console.error(e)}},[eb,ej]=(0,a.useState)(!1),ey={gender:"M",status:"Living",generation:2},[ew,e_]=(0,a.useState)(ey),[eN,ek]=(0,a.useState)(""),[eC,eM]=(0,a.useState)(""),[eS,eE]=(0,a.useState)(""),eA=(0,a.useMemo)(()=>Array.from(v.values()),[v]),eD=async()=>{if(!ew.first_name||!ew.last_name){alert("First and last name are required");return}if(!ew.status){alert("Status is required");return}if("number"!=typeof ew.generation||isNaN(ew.generation)){alert("Generation is required");return}if(!ew.gender){alert("Gender is required");return}try{let e="undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2)),{data:t,error:l}=await eo.from("people").insert({id:e,...ew}).select().single();if(l)throw l;let r=(null==t?void 0:t.id)||e,a=[],n=()=>"undefined"!=typeof crypto&&crypto.randomUUID?crypto.randomUUID():"".concat(Date.now(),"-").concat(Math.random().toString(36).slice(2));if(eN&&a.push({id:n(),parent_id:eN,child_id:r}),eC&&a.push({id:n(),parent_id:eC,child_id:r}),a.length){let{error:e}=await eo.from("parent_child").insert(a);if(e)throw e}if(eS){let{error:e}=await eo.from("marriages").insert({id:n(),partner_a:r,partner_b:eS});if(e)throw e}ej(!1),ek(""),eM(""),eE(""),e_(ey),f&&await f()}catch(e){console.error(e)}};(0,a.useEffect)(()=>{if(!ed)return;let e=e=>{"Escape"===e.key&&ei(null)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ed]);let eI=(0,a.useRef)(!1);return(0,a.useEffect)(()=>{!eI.current&&E.length>0&&(en(),eI.current=!0)},[E.length]),(0,a.useEffect)(()=>{window.innerWidth<1024&&F(!1)},[]),(0,r.jsxs)("div",{className:"flex h-screen overflow-hidden",children:[P&&(0,r.jsxs)("aside",{className:"w-80 border-r border-slate-800 bg-slate-900/70 glass p-4 space-y-4 overflow-y-auto relative",children:[(0,r.jsxs)("div",{className:"sticky top-0 z-10 bg-slate-900/90 pt-2 pb-3 space-y-2",children:[(0,r.jsxs)("div",{className:"px-1 text-lg font-semibold text-slate-100",children:["Family Tree ",(0,r.jsx)("span",{className:"text-pink-400",children:"❤"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(s.Z,{className:"h-5 w-5 text-slate-400"}),(0,r.jsx)("input",{className:"w-full rounded-md bg-slate-800/70 border border-slate-700 px-3 py-2 text-slate-100 placeholder:text-slate-400 focus:outline-none focus:ring",placeholder:"Search by name...",value:g,onChange:e=>m(e.target.value)})]})]}),(0,r.jsxs)("div",{className:"sticky top-20 flex items-center gap-2 z-10 bg-slate-900/90 py-2",children:[(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>I(e=>Math.min(2,e+.1)),children:"+"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:()=>I(e=>Math.max(.3,e-.1)),children:"-"}),(0,r.jsx)("button",{className:"rounded bg-slate-800 hover:bg-slate-700 text-slate-100 px-3 py-1",onClick:en,children:"Reset"})]}),Array.from(new Set(h.map(e=>{var t;return null!==(t=e.generation)&&void 0!==t?t:0}))).sort((e,t)=>e-t).map(e=>{let t=h.filter(t=>{var l;return(null!==(l=t.generation)&&void 0!==l?l:0)===e}).sort((e,t)=>{var l,r,a,n,s,i,d,o,c,u;let h=(null!==(d=null===(l=S.get(e.id))||void 0===l?void 0:l.parents)&&void 0!==d?d:[]).slice().sort().join("|"),x=(null!==(o=null===(r=S.get(t.id))||void 0===r?void 0:r.parents)&&void 0!==o?o:[]).slice().sort().join("|"),p=(null!==(c=null===(n=S.get(e.id))||void 0===n?void 0:null===(a=n.parents)||void 0===a?void 0:a.length)&&void 0!==c?c:0)>0?0:1,f=(null!==(u=null===(i=S.get(t.id))||void 0===i?void 0:null===(s=i.parents)||void 0===s?void 0:s.length)&&void 0!==u?u:0)>0?0:1;return p!==f?p-f:h!==x?h.localeCompare(x):(null!=e.birth_date?parseInt(String(e.birth_date),10):Number.MAX_SAFE_INTEGER)-(null!=t.birth_date?parseInt(String(t.birth_date),10):Number.MAX_SAFE_INTEGER)}).map(e=>e.id);return(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("div",{className:"flex items-center justify-between",children:(0,r.jsxs)("div",{className:"text-xs uppercase tracking-wide text-slate-400",children:["Generation ",e]})}),t.map(e=>{var t;let l=S.get(e);if(!l)return null;let a=(l.preferred_name||l.first_name||"")+" "+(l.last_name||"");return g&&!a.toLowerCase().includes(g.toLowerCase())?null:(0,r.jsxs)("button",{className:"w-full flex items-center gap-3 rounded px-2 py-2 hover:bg-slate-800/70",onClick:()=>{_&&ei(e)},children:[l.photo?(0,r.jsx)("img",{src:l.photo,alt:a,className:"h-9 w-9 rounded-full object-cover"}):(0,r.jsx)("div",{className:"h-9 w-9 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"text-sm text-slate-100",children:a}),(0,r.jsx)("div",{className:"text-[11px] text-slate-400",children:null!==(t=l.status)&&void 0!==t?t:"Unknown"})]})]},e)})]},e)}),(0,r.jsx)("div",{className:"text-xs text-gray-500 mt-4",children:"Tip: drag to pan, scroll to zoom. Click a name to center."})]}),(0,r.jsxs)("main",{className:"flex-1 relative bg-gradient-to-b from-slate-900 to-slate-950",onPointerDown:$,onPointerMove:ee,onPointerUp:el,onPointerCancel:er,style:{touchAction:"none"},children:[(0,r.jsx)("button",{className:"absolute left-2 top-2 z-50 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40",onClick:()=>{F(e=>!e),setTimeout(en,50)},children:P?"Hide sidebar":"Show sidebar"}),(0,r.jsxs)("svg",{ref:T,className:"absolute inset-0 w-full h-full",onWheel:e=>{I(Math.min(2,Math.max(.3,D-.001*e.deltaY)))},onMouseDown:e=>{e.target.closest("[data-node]")||J(e)},onMouseMove:e=>{if(!W.current)return;let t=e.clientX-Y.current.x,l=e.clientY-Y.current.y;z(e=>({x:e.x+t,y:e.y+l})),Y.current={x:e.clientX,y:e.clientY}},onMouseUp:()=>{W.current=!1},onPointerDown:$,onPointerMove:ee,onPointerUp:el,onPointerCancel:er,style:{touchAction:B?"manipulation":"none"},children:[(0,r.jsxs)("defs",{children:[(0,r.jsx)("marker",{id:"arrow",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto-start-reverse",children:(0,r.jsx)("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#475569"})}),(0,r.jsx)("filter",{id:"coupleShadow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:(0,r.jsx)("feDropShadow",{dx:"0",dy:"2",stdDeviation:"3",floodColor:"#000",floodOpacity:"0.25"})})]}),(0,r.jsxs)("g",{transform:"translate(".concat(L.x,", ").concat(L.y,") scale(").concat(D,")"),children:[(()=>{let e=new Set;for(let t of M.mar){let l=t.partner_a<t.partner_b?t.partner_a:t.partner_b,r=t.partner_a<t.partner_b?t.partner_b:t.partner_a;e.add("".concat(l,"|").concat(r))}let t=new Map;for(let e of p)t.has(e.child_id)||t.set(e.child_id,new Set),t.get(e.child_id).add(e.parent_id);let l=[],a=new Set;for(let[r,n]of t){if(O(r)){a.add(r);continue}let t=Array.from(n);if(t.length>=2){let n=t[0],s=t[1],i=n<s?n:s,d=n<s?s:n;if(e.has("".concat(i,"|").concat(d))){let e=A.get(i),t=A.get(d),n=A.get(r);if(e&&t&&n){let s=(e.x+t.x)/2,o=Math.max(e.y,t.y)+75,c=n.x,u=n.y-75;l.push({key:"".concat(i,"-").concat(d,"-").concat(r),x1:s,y1:o,x2:c,y2:u}),a.add(r)}}}}for(let e of p){if(O(e.child_id)||a.has(e.child_id))continue;let t=A.get(e.parent_id),r=A.get(e.child_id);if(!t||!r)continue;let n=t.x,s=t.y+75,i=r.x,d=r.y-75;l.push({key:e.id,x1:n,y1:s,x2:i,y2:d})}return l.map(e=>(0,r.jsx)("path",{d:"M ".concat(e.x1," ").concat(e.y1," C ").concat(e.x1," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat((e.y1+e.y2)/2,", ").concat(e.x2," ").concat(e.y2),stroke:"#475569",strokeWidth:"3",fill:"none",markerEnd:"url(#arrow)"},e.key))})(),M.mar.map(e=>{let t=A.get(e.partner_a),l=A.get(e.partner_b);if(!t||!l)return null;let a=t.y,n=Math.min(t.x-70,l.x-70),s=Math.max(t.x+70,l.x+70);return(0,r.jsx)("rect",{x:n-12,y:a-75-8,width:s-n+24,height:166,rx:20,ry:20,fill:"rgba(255,255,255,0.07)",stroke:"rgba(255,255,255,0.28)",strokeWidth:1,filter:"url(#coupleShadow)"},e.id)}),(()=>{let e=Array.from(new Set(E.map(e=>e.depth))).sort((e,t)=>e-t),t=Math.min(...E.map(e=>e.x))-200,l=Math.max(...E.map(e=>e.x))+200;return e.map(e=>{let a=180*e;return(0,r.jsxs)("g",{children:[(0,r.jsx)("line",{x1:t,y1:a,x2:l,y2:a,stroke:"#1f2937",strokeDasharray:"6 10",strokeWidth:2}),(0,r.jsx)("rect",{x:t,y:a-20,width:120,height:28,rx:8,fill:"#0f172a",stroke:"#1f2937"}),(0,r.jsxs)("text",{x:t+60,y:a-2,fill:"#e2e8f0",fontSize:12,textAnchor:"middle",children:["Generation ",e]})]},e)})})(),Array.from(new Map(E.map(e=>[e.id,e])).values()).filter(e=>!O(e.id)).map(e=>{var t,l,a,s;let i=S.get(e.id),d="M"===i.gender?"bg-male/90":"F"===i.gender?"bg-female/90":"bg-neutral/80",o=(i.status||"").toLowerCase(),c=e.x-70,u=e.y-75,h=v.get(i.id)||i,x=null!==(l=null==h?void 0:h.partners)&&void 0!==l?l:[],p=x.length>0||(null!==(a=null==h?void 0:null===(t=h.children)||void 0===t?void 0:t.length)&&void 0!==a?a:0)>0,f="none";if(p){if(x.length>0){let e=k(i.id,x[0]);f=b.has(e)?"collapsed":"expanded"}else f=y.has(i.id)?"collapsed":"expanded"}if(B){let t="M"===i.gender?"rgba(56,189,248,0.9)":"F"===i.gender?"rgba(244,114,182,0.9)":"rgba(148,163,184,0.8)",l=e.x-70,a=e.y-75,n="clip-".concat(e.id),s=i.status?String(i.status).toLowerCase():"unknown",d=Math.max(54,6*s.length+18);return(0,r.jsxs)("g",{"data-node":!0,onClick:()=>{_?ei(e.id):ea(e.id)},children:[(0,r.jsx)("defs",{children:(0,r.jsx)("clipPath",{id:n,children:(0,r.jsx)("circle",{cx:e.x,cy:e.y-32,r:26})})}),(0,r.jsx)("rect",{x:l,y:a,rx:16,ry:16,width:140,height:150,fill:t,stroke:"rgba(255,255,255,0.15)"}),"none"!==f&&(0,r.jsx)("text",{x:l+140-10,y:a+14,textAnchor:"end",fontSize:16,fill:"#fff",children:"collapsed"===f?"+":"−"}),i.photo?(0,r.jsx)("image",{href:i.photo,x:e.x-26,y:e.y-58,width:52,height:52,clipPath:"url(#".concat(n,")"),preserveAspectRatio:"xMidYMid slice"}):(0,r.jsx)("text",{x:e.x,y:e.y-32,textAnchor:"middle",fontSize:24,children:"\uD83D\uDC64"}),(0,r.jsx)("text",{x:e.x,y:e.y-2,textAnchor:"middle",fontSize:11,fill:"#fff",fontWeight:600,children:(i.preferred_name||i.first_name)+" "+(i.last_name||"")}),(0,r.jsxs)("g",{children:[(0,r.jsx)("rect",{x:e.x-d/2,y:e.y+4,width:d,height:16,rx:8,fill:"#ffffff",opacity:.95}),(0,r.jsx)("circle",{cx:e.x-d/2+8,cy:e.y+12,r:3,fill:"deceased"===o?"#f87171":"living"===o?"#22c55e":"#cbd5e1"}),(0,r.jsx)("text",{x:e.x-d/2+14,y:e.y+14,textAnchor:"start",fontSize:9,fill:"#0f172a",children:s})]}),i.children.length>0&&(0,r.jsxs)("text",{x:e.x,y:e.y+26,textAnchor:"middle",fontSize:10,fill:"#fff",children:["\uD83D\uDC76 ",i.children.length]})]},e.id)}return(0,r.jsx)("foreignObject",{x:c,y:u,width:140,height:150,"data-node":!0,onPointerDown:e=>{e.stopPropagation()},onPointerMove:e=>{e.stopPropagation()},onPointerUp:e=>{e.stopPropagation()},onPointerCancel:e=>{e.stopPropagation()},children:(0,r.jsxs)("div",{className:(0,n.W)("rounded-2xl shadow-card text-white flex flex-col items-center justify-center h-full px-3 py-2 cursor-pointer relative select-none",d),onClick:()=>{_?ei(e.id):ea(e.id)},style:{touchAction:B?"manipulation":"none"},children:["none"!==f&&(0,r.jsx)("div",{className:"absolute top-1.5 right-2 text-lg font-semibold text-white/90 select-none pointer-events-none",children:"collapsed"===f?"+":"−"}),(0,r.jsx)("div",{className:"relative mb-2",children:i.photo?(0,r.jsx)("img",{src:i.photo,alt:null!==(s=i.first_name)&&void 0!==s?s:"",className:"h-24 w-24 rounded-full object-cover ring-2 ring-white/20"}):(0,r.jsx)("div",{className:"h-24 w-24 rounded-full bg-black/20 grid place-items-center text-3xl",children:"\uD83D\uDC64"})}),(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsxs)("div",{className:"text-xs font-semibold leading-4",children:[i.preferred_name||i.first_name," ",i.last_name]}),(()=>{let e=i.status?String(i.status).toLowerCase():"unknown";return(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 bg-white/95 text-slate-900 rounded-full px-2 py-0.5 text-[10px] mt-0.5",children:[(0,r.jsx)("span",{className:(0,n.W)("w-1.5 h-1.5 rounded-full","deceased"===o?"bg-red-400":"living"===o?"bg-green-500":"bg-slate-300")}),e]})})(),(0,r.jsx)("div",{className:"flex items-center justify-center gap-2 mt-1 text-white/90",children:i.children.length>0&&(0,r.jsxs)("span",{className:"inline-flex items-center gap-1 text-[10px]",children:[(0,r.jsx)("span",{role:"img","aria-label":"children",children:"\uD83D\uDC76"})," ",i.children.length]})})]})]})},e.id)})]})]}),(0,r.jsxs)("div",{className:"fixed md:absolute left-2 top-2 z-50 flex flex-col gap-2",style:{paddingTop:"env(safe-area-inset-top)",paddingLeft:"env(safe-area-inset-left)"},children:[(0,r.jsx)("button",{className:"w-40 rounded bg-slate-800 hover:bg-slate-700 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{R?X():G()},children:R?"Expand all":"Collapse all"}),(0,r.jsx)("button",{className:"w-40 rounded bg-emerald-500 hover:bg-emerald-400 text-slate-900 font-semibold px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{F(e=>!e),setTimeout(en,50)},children:P?"Hide sidebar":"Show sidebar"}),(0,r.jsx)("button",{className:"w-40 rounded bg-slate-800 hover:bg-slate-700 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>N(!_),children:_?"Exit edit mode":"Edit mode"}),(0,r.jsx)("button",{className:"w-40 rounded bg-blue-600 hover:bg-blue-500 text-white px-3 py-1 shadow-lg ring-2 ring-white/40 text-left",onClick:()=>{e_(ey),ek(""),eM(""),eE(""),ej(!0)},children:"Add person"})]}),ed&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>ei(null),children:(0,r.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[800px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center gap-4 p-5 border-b border-slate-800",children:[ed.photo?(0,r.jsx)("img",{src:ed.photo,alt:"",className:"h-20 w-20 rounded-full object-cover ring-2 ring-white/10"}):(0,r.jsx)("div",{className:"h-20 w-20 rounded-full bg-slate-700 grid place-items-center",children:"\uD83D\uDC64"}),(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"text-xl font-semibold",children:[ed.preferred_name||ed.first_name," ",ed.last_name]}),(0,r.jsx)("div",{className:"text-sm text-slate-400 capitalize",children:(ed.status||"").toString()})]}),(0,r.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ei(null),children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"First name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.first_name||"",onChange:e=>eu(t=>({...t,first_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Last name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.last_name||"",onChange:e=>eu(t=>({...t,last_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.preferred_name||"",onChange:e=>eu(t=>({...t,preferred_name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Gender"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.gender||"",onChange:e=>eu(t=>({...t,gender:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"M",children:"M"}),(0,r.jsx)("option",{value:"F",children:"F"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Status",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:ec.status||"",onChange:e=>eu(t=>({...t,status:e.target.value})),children:[(0,r.jsx)("option",{value:"Living",children:"Living"}),(0,r.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.birth_date||"",onChange:e=>eu(t=>({...t,birth_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.birth_place||"",onChange:e=>eu(t=>({...t,birth_place:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Death date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.death_date||"",onChange:e=>eu(t=>({...t,death_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Death place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.death_place||"",onChange:e=>eu(t=>({...t,death_place:e.target.value}))})]})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Generation",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:String(null!==(l=ec.generation)&&void 0!==l?l:""),onChange:e=>eu(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null})),children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eh,onChange:e=>ex(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eA.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ep,onChange:e=>ef(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eA.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ev,onChange:e=>eg(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eA.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Phone"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.phone||"",onChange:e=>eu(t=>({...t,phone:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Facebook"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.facebook||"",onChange:e=>eu(t=>({...t,facebook:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ec.photo||"",onChange:e=>eu(t=>({...t,photo:e.target.value}))})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:em,children:"Save"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ei(null),children:"Cancel"})]})]})]}),(0,r.jsxs)("div",{className:"p-5",children:[(0,r.jsx)("div",{className:"text-xs text-slate-400 mb-2",children:"Family"}),(0,r.jsx)("div",{className:"bg-slate-800/50 rounded-lg p-4",children:(0,r.jsx)("svg",{width:"100%",height:"240",viewBox:"0 0 640 240",children:(()=>{var e,t,l;let a=(null!==(e=ed.parents)&&void 0!==e?e:[]).map(e=>S.get(e)).filter(Boolean),n=(null!==(t=ed.partners)&&void 0!==t?t:[]).map(e=>S.get(e)).filter(Boolean),s=(null!==(l=ed.children)&&void 0!==l?l:[]).map(e=>S.get(e)).filter(Boolean),i=a.map((e,t)=>160+t*(a.length>1?320:0)),d=n.map((e,t)=>320+(t+1)*140),o=s.length>1?s.map((e,t)=>100+440/(s.length-1)*t):[320],c=[];return a.forEach((e,t)=>{c.push((0,r.jsxs)("text",{x:i[t],y:30,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"pt-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(i[t]," ").concat(36," L ").concat(320," ").concat(106),stroke:"#64748b"},"p-line-".concat(e.id)))}),c.push((0,r.jsx)("circle",{cx:320,cy:120,r:12,fill:"#38bdf8"},"me")),c.push((0,r.jsxs)("text",{x:320,y:148,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[ed.preferred_name||ed.first_name," ",ed.last_name||""]},"me-t")),n.forEach((e,t)=>{c.push((0,r.jsx)("circle",{cx:d[t],cy:120,r:10,fill:"#f472b6"},"sp-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(332," ").concat(120," L ").concat(d[t]-12," ").concat(120),stroke:"#fb7185",strokeDasharray:"6 4"},"m-".concat(e.id)))}),s.forEach((e,t)=>{c.push((0,r.jsxs)("text",{x:o[t],y:210,textAnchor:"middle",fontSize:12,fill:"#e2e8f0",children:[e.preferred_name||e.first_name," ",e.last_name||""]},"ch-".concat(e.id))),c.push((0,r.jsx)("path",{d:"M ".concat(320," ").concat(134," L ").concat(o[t]," ").concat(196),stroke:"#64748b"},"c-line-".concat(e.id)))}),c})()})})]})]})}),eb&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-6 z-50",onClick:()=>ej(!1),children:(0,r.jsxs)("div",{className:"bg-slate-900 text-slate-100 rounded-2xl shadow-xl border border-slate-800 w-[820px] max-w-[95vw]",onClick:e=>e.stopPropagation(),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-slate-800",children:[(0,r.jsx)("div",{className:"text-lg font-semibold",children:"Add new person"}),(0,r.jsx)("button",{className:"px-3 py-1 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ej(!1),children:"Close"})]}),(0,r.jsxs)("div",{className:"p-5 grid grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["First name",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:ew.first_name||"",onChange:e=>e_(t=>({...t,first_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Last name",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:ew.last_name||"",onChange:e=>e_(t=>({...t,last_name:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Preferred name"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ew.preferred_name||"",onChange:e=>e_(t=>({...t,preferred_name:e.target.value}))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Gender",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:ew.gender||"",onChange:e=>e_(t=>({...t,gender:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"M",children:"M"}),(0,r.jsx)("option",{value:"F",children:"F"})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Status",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:ew.status||"",onChange:e=>e_(t=>({...t,status:e.target.value})),children:[(0,r.jsx)("option",{value:"",children:"—"}),(0,r.jsx)("option",{value:"Living",children:"Living"}),(0,r.jsx)("option",{value:"Deceased",children:"Deceased"})]})]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth date"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ew.birth_date||"",onChange:e=>e_(t=>({...t,birth_date:e.target.value}))})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Birth place"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ew.birth_place||"",onChange:e=>e_(t=>({...t,birth_place:e.target.value}))})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Photo URL"}),(0,r.jsx)("input",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:ew.photo||"",onChange:e=>e_(t=>({...t,photo:e.target.value}))})]})]}),(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("label",{className:"block text-xs text-slate-400",children:["Generation",(0,r.jsx)("span",{className:"text-red-400",children:" *"})]}),(0,r.jsx)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",required:!0,value:String(null!==(d=ew.generation)&&void 0!==d?d:""),onChange:e=>e_(t=>({...t,generation:e.target.value?parseInt(e.target.value,10):null})),children:[0,1,2,3,4,5,6,7,8,9].map(e=>(0,r.jsx)("option",{value:e,children:e},e))})]}),(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Father (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eN,onChange:e=>ek(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eA.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Mother (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eC,onChange:e=>eM(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eA.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-slate-400",children:"Partner (optional)"}),(0,r.jsxs)("select",{className:"w-full bg-slate-800 border border-slate-700 rounded px-3 py-2",value:eS,onChange:e=>eE(e.target.value),children:[(0,r.jsx)("option",{value:"",children:"—"}),eA.map(e=>(0,r.jsxs)("option",{value:e.id,children:[e.preferred_name||e.first_name," ",e.last_name||""]},e.id))]})]}),(0,r.jsxs)("div",{className:"pt-2 flex gap-2",children:[(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-blue-600 hover:bg-blue-500",onClick:eD,children:"Create"}),(0,r.jsx)("button",{className:"px-4 py-2 rounded bg-slate-800 hover:bg-slate-700",onClick:()=>ej(!1),children:"Cancel"})]})]})]})]})})]})]})}var x=l(257);function p(){let[e,t]=(0,a.useState)(null),[l,n]=(0,a.useState)(null),[s,i]=(0,a.useState)(null),d=async()=>{var e,l,r;if("true"===x.env.NEXT_PUBLIC_USE_JSON_FALLBACK||"true"===x.env.USE_JSON_FALLBACK)try{let e=await fetch("/data/sample.json",{cache:"no-store"});if(e.ok){let l=await e.json();t(l.people||[]),n(l.marriages||[]),i(l.parent_child||[]);return}}catch(e){}let a=o(),[s,d,c]=await Promise.all([a.from("people").select("*").returns(),a.from("marriages").select("*").returns(),a.from("parent_child").select("*").returns()]);t(null!==(e=s.data)&&void 0!==e?e:[]),n(null!==(l=d.data)&&void 0!==l?l:[]),i(null!==(r=c.data)&&void 0!==r?r:[])};return((0,a.useEffect)(()=>{d()},[]),e&&l&&s)?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(h,{people:e,marriages:l,parentChild:s,onChanged:d}),(0,r.jsx)("div",{id:"modal-root",className:"fixed inset-0 pointer-events-none"})]}):(0,r.jsx)("div",{className:"min-h-screen grid place-items-center text-slate-300",children:"Loading…"})}},3538:function(e,t,l){"use strict";l.d(t,{EditModeProvider:function(){return s},S:function(){return i}});var r=l(7437),a=l(2265);let n=(0,a.createContext)(void 0);function s(e){let{children:t}=e,[l,s]=(0,a.useState)(!1);return(0,r.jsx)(n.Provider,{value:{editMode:l,setEditMode:s},children:t})}function i(){let e=(0,a.useContext)(n);if(!e)throw Error("useEditMode must be used within EditModeProvider");return e}}},function(e){e.O(0,[156,971,117,744],function(){return e(e.s=1169)}),_N_E=e.O()}]);